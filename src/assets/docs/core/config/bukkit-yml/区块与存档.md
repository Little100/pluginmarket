# bukkit.yml 配置详解 - 区块与存档

## 概述

本节介绍 bukkit.yml 中与区块管理和自动存档相关的配置：
- `chunk-gc`：区块垃圾回收设置
- `autosave`：自动保存间隔设置

这些配置直接影响服务器的内存使用和数据安全性。

---

## chunk-gc 节点

chunk-gc（Chunk Garbage Collection）控制服务器的区块垃圾回收机制，用于卸载不再需要的区块以释放内存。

```yaml
chunk-gc:
  period-in-ticks: 600
```

### period-in-ticks

| 属性 | 值 |
|------|-----|
| 键名 | `chunk-gc.period-in-ticks` |
| 类型 | 整数 |
| 默认值 | `600` |

控制区块垃圾回收的执行间隔（游戏刻）。

默认值 `600` 表示每 30 秒执行一次区块垃圾回收。

**工作原理**：
1. 服务器会定期检查已加载的区块
2. 如果某个区块周围没有玩家，且没有被强制加载（如出生点区块）
3. 该区块会被标记为可卸载
4. 垃圾回收时，这些区块会被从内存中移除

**配置建议**：
- 较小的值（如 `300`）：更频繁地回收，内存占用更低，但可能增加 CPU 负担
- 较大的值（如 `1200`）：回收频率降低，内存占用可能更高，但 CPU 负担更小
- 设置为 `0`：禁用自动区块垃圾回收（不推荐）

对于内存紧张的服务器，可以适当降低此值；对于内存充足的服务器，可以适当增加此值以减少 CPU 开销。

---

## autosave 配置

autosave 控制服务器自动保存世界数据的间隔。此配置位于 `ticks-per` 节点下。

```yaml
ticks-per:
  autosave: 6000
```

### autosave

| 属性 | 值 |
|------|-----|
| 键名 | `ticks-per.autosave` |
| 类型 | 整数 |
| 默认值 | `6000` |

控制世界自动保存的间隔（游戏刻）。

默认值 `6000` 表示每 5 分钟自动保存一次世界数据。

**自动保存的内容**：
- 世界区块数据
- 玩家数据（位置、背包、经验等）
- 实体数据

**配置建议**：

| 场景 | 推荐值 | 说明 |
|------|--------|------|
| 小型服务器 | `6000`（5分钟） | 默认值，平衡性能和数据安全 |
| 大型服务器 | `12000`（10分钟） | 减少保存频率，降低 I/O 压力 |
| 高安全需求 | `3000`（2.5分钟） | 更频繁保存，减少数据丢失风险 |
| SSD 存储 | `6000` | SSD 写入速度快，可保持默认 |
| HDD 存储 | `12000-18000` | 减少机械硬盘的写入压力 |

**注意事项**：
1. 自动保存会导致短暂的服务器卡顿（尤其是大型世界）
2. 设置过于频繁会增加磁盘 I/O 压力
3. 设置过于稀疏会增加服务器崩溃时的数据丢失风险
4. Paper 服务端对自动保存有优化，卡顿感会明显减少

---

## 手动保存命令

除了自动保存，管理员还可以使用以下命令手动保存：

| 命令 | 说明 |
|------|------|
| `/save-all` | 保存所有世界和玩家数据 |
| `/save-all flush` | 强制立即写入磁盘 |
| `/save-off` | 禁用自动保存 |
| `/save-on` | 启用自动保存 |

**备份建议**：
在进行服务器备份前，建议执行以下步骤：
1. 执行 `/save-all flush` 确保所有数据写入磁盘
2. 执行 `/save-off` 暂停自动保存
3. 进行备份操作
4. 执行 `/save-on` 恢复自动保存

---

## 推荐配置

### 标准服务器配置

```yaml
chunk-gc:
  period-in-ticks: 600

ticks-per:
  autosave: 6000
```

### 性能优化配置（大型服务器）

```yaml
chunk-gc:
  period-in-ticks: 400    # 更频繁回收，减少内存占用

ticks-per:
  autosave: 12000         # 降低保存频率，减少 I/O 压力
```

### 数据安全优先配置

```yaml
chunk-gc:
  period-in-ticks: 600    # 保持默认

ticks-per:
  autosave: 3000          # 更频繁保存，减少数据丢失风险
```

---

## 与 Paper 的关系

如果你使用 Paper 服务端，以下配置可能会覆盖或补充 bukkit.yml 的设置：

- `paper.yml` 中的 `max-auto-save-chunks-per-tick`：限制每 tick 保存的区块数量，减少保存时的卡顿
- `paper.yml` 中的 `prevent-moving-into-unloaded-chunks`：防止玩家移动到未加载的区块

建议同时参考 Paper 的配置文档以获得最佳性能。
