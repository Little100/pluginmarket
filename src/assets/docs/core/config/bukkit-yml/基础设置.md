# bukkit.yml 配置详解 - 基础设置

## settings 节点概述

settings 部分包含服务器的基础设置选项，控制末地开关、权限文件、插件更新、连接限制等核心功能。

```yaml
settings:
  allow-end: true
  warn-on-overload: true
  permissions-file: permissions.yml
  update-folder: update
  plugin-profiling: false
  connection-throttle: 4000
  query-plugins: true
  deprecated-verbose: default
  shutdown-message: Server closed
  minimum-api: none
```

---

## 配置项详解

### allow-end

| 属性 | 值 |
|------|-----|
| 键名 | `settings.allow-end` |
| 类型 | 布尔值 |
| 默认值 | `true` |

控制是否启用末地（The End）维度。

- `true`：玩家可以通过末地传送门进入末地
- `false`：禁用末地，玩家无法进入末地维度

如果你的服务器不需要末地内容（如末影龙战斗、末地城探索等），可以设置为 `false` 以节省服务器资源。

---

### warn-on-overload

| 属性 | 值 |
|------|-----|
| 键名 | `settings.warn-on-overload` |
| 类型 | 布尔值 |
| 默认值 | `true` |

控制服务器是否在控制台输出过载警告信息。

- `true`：当服务器 TPS 下降时，在控制台显示 "Can't keep up!" 警告
- `false`：禁止显示此警告

此选项仅影响警告信息的显示，不会改变服务器的实际性能表现。建议保持开启以便及时发现性能问题。

---

### permissions-file

| 属性 | 值 |
|------|-----|
| 键名 | `settings.permissions-file` |
| 类型 | 字符串 |
| 默认值 | `permissions.yml` |

指定 Bukkit 内置权限系统使用的权限配置文件名。

此文件用于定义权限组和权限节点。但在实际使用中，大多数服务器会使用专门的权限管理插件（如 LuckPerms、PermissionsEx 等），这些插件会完全接管权限系统，使此配置项失效。

---

### update-folder

| 属性 | 值 |
|------|-----|
| 键名 | `settings.update-folder` |
| 类型 | 字符串 |
| 默认值 | `update` |

指定插件自动更新文件夹的名称。

当插件支持自动更新功能时，新版本的插件 jar 文件会被下载到 `plugins/update/` 目录下。服务器重启时，系统会自动用新版本替换旧版本。

目录结构示例：
```
plugins/
├── SomePlugin.jar
├── AnotherPlugin.jar
└── update/
    └── SomePlugin.jar  ← 新版本，重启后会替换上级目录的同名文件
```

---

### plugin-profiling

| 属性 | 值 |
|------|-----|
| 键名 | `settings.plugin-profiling` |
| 类型 | 布尔值 |
| 默认值 | `false` |

控制是否启用插件性能分析功能。

- `true`：启用 `/timings` 命令，可以分析各插件的性能消耗
- `false`：禁用此功能

启用后可以使用 `/timings on`、`/timings paste` 等命令来分析服务器性能瓶颈。对于 Paper 服务端，建议使用更强大的 Spark 插件进行性能分析。

---

### connection-throttle

| 属性 | 值 |
|------|-----|
| 键名 | `settings.connection-throttle` |
| 类型 | 整数（毫秒） |
| 默认值 | `4000` |

控制同一 IP 地址连续连接服务器的最小间隔时间（毫秒）。

此设置用于防止连接洪水攻击。如果同一 IP 在指定时间内多次尝试连接，后续连接会被拒绝。

- 设置为 `0` 或负数可禁用此限制
- 如果使用 BungeeCord/Velocity 等代理，建议设置为 `-1`，因为所有连接都来自代理服务器的 IP

---

### query-plugins

| 属性 | 值 |
|------|-----|
| 键名 | `settings.query-plugins` |
| 类型 | 布尔值 |
| 默认值 | `true` |

控制是否允许通过服务器查询协议（Query）获取已安装插件列表。

- `true`：允许外部工具查询服务器的插件列表
- `false`：隐藏插件列表信息

出于安全考虑，建议在生产环境中设置为 `false`，避免暴露服务器使用的插件信息。

---

### deprecated-verbose

| 属性 | 值 |
|------|-----|
| 键名 | `settings.deprecated-verbose` |
| 类型 | 字符串 |
| 默认值 | `default` |

控制是否在控制台显示插件使用已弃用 API 的警告信息。

可选值：
- `default`：使用服务端默认行为
- `true`：显示所有弃用 API 警告
- `false`：隐藏弃用 API 警告

此选项主要用于插件开发者调试，普通服务器管理员可以保持默认值。

---

### shutdown-message

| 属性 | 值 |
|------|-----|
| 键名 | `settings.shutdown-message` |
| 类型 | 字符串 |
| 默认值 | `Server closed` |

设置服务器关闭时向所有在线玩家显示的断开连接消息。

支持颜色代码，例如：
```yaml
shutdown-message: "&c服务器正在重启，请稍后再来！"
```

---

### minimum-api

| 属性 | 值 |
|------|-----|
| 键名 | `settings.minimum-api` |
| 类型 | 字符串 |
| 默认值 | `none` |

设置服务器要求插件支持的最低 API 版本。

- `none`：不限制，加载所有插件
- 指定版本（如 `1.13`）：只加载声明支持该版本或更高版本 API 的插件

此选项可以防止加载过时的、可能不兼容的插件。但设置过高可能导致一些仍然正常工作的老插件无法加载。

---

## 推荐配置

对于大多数服务器，以下是推荐的 settings 配置：

```yaml
settings:
  allow-end: true                    # 根据需要开关末地
  warn-on-overload: true             # 保持开启以监控性能
  permissions-file: permissions.yml  # 使用权限插件时可忽略
  update-folder: update              # 保持默认
  plugin-profiling: false            # 需要时再开启
  connection-throttle: 4000          # 使用代理时设为 -1
  query-plugins: false               # 生产环境建议关闭
  deprecated-verbose: false          # 减少控制台噪音
  shutdown-message: "服务器维护中，请稍后再来"
  minimum-api: none                  # 保持默认
```
