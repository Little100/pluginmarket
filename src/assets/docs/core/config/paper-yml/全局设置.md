# Paper 全局设置

本文档介绍 `paper-global.yml` 中的基础全局配置项。这些配置影响整个服务器的运行。

## collisions（碰撞）

控制实体碰撞相关的设置。

```yaml
collisions:
  enable-player-collisions: true
  send-full-pos-for-hard-colliding-entities: true
```

| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| `enable-player-collisions` | `true` | 是否启用玩家之间的碰撞。设为 `false` 可以让玩家互相穿过 |
| `send-full-pos-for-hard-colliding-entities` | `true` | 是否为硬碰撞实体发送完整位置信息，有助于减少实体穿墙 |

## commands（命令）

命令相关的配置。

```yaml
commands:
  fix-target-selector-tag-completion: true
  suggest-player-names-when-null-tab-completions: true
  time-command-affects-all-worlds: false
```

| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| `fix-target-selector-tag-completion` | `true` | 修复目标选择器标签的自动补全 |
| `suggest-player-names-when-null-tab-completions` | `true` | 当没有其他补全建议时，是否建议玩家名称 |
| `time-command-affects-all-worlds` | `false` | `/time` 命令是否影响所有世界。设为 `true` 时，修改时间会同时影响所有世界 |

## console（控制台）

控制台输出相关配置。

```yaml
console:
  enable-brigadier-completions: true
  enable-brigadier-highlighting: true
  has-all-permissions: false
```

| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| `enable-brigadier-completions` | `true` | 启用 Brigadier 命令补全 |
| `enable-brigadier-highlighting` | `true` | 启用 Brigadier 命令高亮 |
| `has-all-permissions` | `false` | 控制台是否拥有所有权限。设为 `true` 时控制台可以执行任何命令 |

## item-validation（物品验证）

物品数据验证相关配置，用于防止恶意物品数据。

```yaml
item-validation:
  display-name: 8192
  loc-name: 8192
  lore-line: 8192
  book:
    author: 8192
    page: 16384
    title: 8192
  resolve-selectors-in-books: false
```

| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| `display-name` | `8192` | 物品显示名称的最大字符数 |
| `loc-name` | `8192` | 本地化名称的最大字符数 |
| `lore-line` | `8192` | 物品描述每行的最大字符数 |
| `book.author` | `8192` | 书本作者名的最大字符数 |
| `book.page` | `16384` | 书本每页的最大字符数 |
| `book.title` | `8192` | 书本标题的最大字符数 |
| `resolve-selectors-in-books` | `false` | 是否解析书本中的目标选择器。建议保持 `false` 以防止潜在的安全问题 |

## logging（日志）

日志记录相关配置。

```yaml
logging:
  deobfuscate-stacktraces: true
  log-player-ip-addresses: true
  use-rgb-for-named-text-colors: true
```

| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| `deobfuscate-stacktraces` | `true` | 是否反混淆堆栈跟踪，使错误信息更易读 |
| `log-player-ip-addresses` | `true` | 是否在日志中记录玩家 IP 地址。出于隐私考虑可设为 `false` |
| `use-rgb-for-named-text-colors` | `true` | 是否使用 RGB 颜色代码 |

## messages（消息）

服务器消息相关配置。

```yaml
messages:
  kick:
    authentication-servers-down: <lang:multiplayer.disconnect.authservers_down>
    connection-throttle: Connection throttled! Please wait before reconnecting.
    flying-player: Flying is not enabled on this server
    flying-vehicle: Flying is not enabled on this server
  no-permission: <red>I'm sorry, but you do not have permission to perform this command.
  use-display-name-in-quit-message: false
```

| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| `kick.authentication-servers-down` | `<lang:...>` | 认证服务器不可用时的踢出消息 |
| `kick.connection-throttle` | `Connection throttled!...` | 连接过于频繁时的踢出消息 |
| `kick.flying-player` | `Flying is not enabled...` | 玩家飞行被踢出时的消息 |
| `kick.flying-vehicle` | `Flying is not enabled...` | 载具飞行被踢出时的消息 |
| `no-permission` | `<red>I'm sorry...` | 没有权限时的提示消息 |
| `use-display-name-in-quit-message` | `false` | 退出消息是否使用玩家显示名称而非真实名称 |

## misc（杂项）

其他杂项配置。

```yaml
misc:
  chat-threads:
    chat-executor-core-size: -1
    chat-executor-max-size: -1
  fix-entity-position-desync: true
  lag-compensate-block-breaking: true
  load-permissions-yml-before-plugins: true
  max-joins-per-tick: 3
  region-file-cache-size: 256
  strict-advancement-dimension-check: false
  use-alternative-luck-formula: false
  use-dimension-type-for-custom-spawners: false
```

| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| `chat-threads.chat-executor-core-size` | `-1` | 聊天线程池核心大小，`-1` 为自动 |
| `chat-threads.chat-executor-max-size` | `-1` | 聊天线程池最大大小，`-1` 为自动 |
| `fix-entity-position-desync` | `true` | 修复实体位置不同步问题 |
| `lag-compensate-block-breaking` | `true` | 启用方块破坏的延迟补偿，改善高延迟玩家体验 |
| `load-permissions-yml-before-plugins` | `true` | 在加载插件前加载 permissions.yml |
| `max-joins-per-tick` | `3` | 每 tick 最多处理的玩家加入数，防止大量玩家同时加入造成卡顿 |
| `region-file-cache-size` | `256` | 区域文件缓存大小 |
| `strict-advancement-dimension-check` | `false` | 是否严格检查进度的维度要求 |
| `use-alternative-luck-formula` | `false` | 是否使用替代的幸运公式 |
| `use-dimension-type-for-custom-spawners` | `false` | 自定义刷怪笼是否使用维度类型 |

## player-auto-save（玩家自动保存）

玩家数据自动保存相关配置。

```yaml
player-auto-save:
  max-per-tick: -1
  rate: -1
```

| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| `max-per-tick` | `-1` | 每 tick 最多保存的玩家数，`-1` 为不限制 |
| `rate` | `-1` | 玩家数据保存间隔（tick），`-1` 使用 `bukkit.yml` 中的设置 |

## scoreboards（计分板）

计分板相关配置。

```yaml
scoreboards:
  save-empty-scoreboard-teams: true
  track-plugin-scoreboards: false
```

| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| `save-empty-scoreboard-teams` | `true` | 是否保存空的计分板队伍 |
| `track-plugin-scoreboards` | `false` | 是否追踪插件创建的计分板。启用可能影响性能 |

## spam-limiter（垃圾信息限制）

防止玩家发送垃圾信息的配置。

```yaml
spam-limiter:
  incoming-packet-threshold: 300
  recipe-spam-increment: 1
  recipe-spam-limit: 20
  tab-spam-increment: 1
  tab-spam-limit: 500
```

| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| `incoming-packet-threshold` | `300` | 传入数据包阈值，超过此值可能被视为垃圾信息 |
| `recipe-spam-increment` | `1` | 配方请求的垃圾计数增量 |
| `recipe-spam-limit` | `20` | 配方请求的垃圾计数上限 |
| `tab-spam-increment` | `1` | Tab 补全请求的垃圾计数增量 |
| `tab-spam-limit` | `500` | Tab 补全请求的垃圾计数上限 |

## timings（性能分析）

Timings 性能分析工具配置。

```yaml
timings:
  enabled: true
  hidden-config-entries:
    - database
    - proxies.velocity.secret
  history-interval: 300
  history-length: 3600
  server-name: Unknown Server
  server-name-privacy: false
  url: https://timings.aikar.co/
  verbose: true
```

| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| `enabled` | `true` | 是否启用 Timings |
| `hidden-config-entries` | `[database, ...]` | 在 Timings 报告中隐藏的配置项 |
| `history-interval` | `300` | 历史记录间隔（秒） |
| `history-length` | `3600` | 历史记录长度（秒） |
| `server-name` | `Unknown Server` | 服务器名称，显示在 Timings 报告中 |
| `server-name-privacy` | `false` | 是否隐藏服务器名称 |
| `url` | `https://timings.aikar.co/` | Timings 报告上传地址 |
| `verbose` | `true` | 是否启用详细模式 |

:::tip 提示
Timings 是 Paper 内置的性能分析工具，可以帮助你找出服务器卡顿的原因。使用 `/timings report` 命令生成报告。

不过现在更推荐使用 [Spark](https://spark.lucko.me/) 进行性能分析，它提供更详细的信息和更好的可视化。
:::

## unsupported-settings（不支持的设置）

这些是实验性或不推荐使用的设置。

```yaml
unsupported-settings:
  allow-grindstone-overstacking: false
  allow-headless-pistons: false
  allow-permanent-block-break-exploits: false
  allow-piston-duplication: false
  compression-format: ZLIB
  perform-username-validation: true
```

| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| `allow-grindstone-overstacking` | `false` | 是否允许砂轮超量堆叠漏洞 |
| `allow-headless-pistons` | `false` | 是否允许无头活塞 |
| `allow-permanent-block-break-exploits` | `false` | 是否允许永久方块破坏漏洞（如基岩破坏） |
| `allow-piston-duplication` | `false` | 是否允许活塞复制漏洞（TNT、地毯等） |
| `compression-format` | `ZLIB` | 区块数据压缩格式 |
| `perform-username-validation` | `true` | 是否验证用户名格式 |

:::warning 警告
`unsupported-settings` 中的选项可能会破坏游戏平衡或导致意外问题。除非你清楚知道自己在做什么，否则不建议修改这些设置。
:::

## watchdog（看门狗）

服务器卡死检测配置。

```yaml
watchdog:
  early-warning-delay: 10000
  early-warning-every: 5000
```

| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| `early-warning-delay` | `10000` | 首次警告延迟（毫秒），服务器卡住多久后开始警告 |
| `early-warning-every` | `5000` | 警告间隔（毫秒），之后每隔多久警告一次 |

:::info 说明
看门狗会监控服务器主线程，如果主线程长时间无响应，会在控制台输出警告信息，帮助你诊断服务器卡死问题。
:::
