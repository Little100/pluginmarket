# spigot.yml 配置详解 - 基础设置

本文档介绍 spigot.yml 中 `settings` 节点下的基础配置选项，包括调试、网络、服务器重启等全局设置。

## settings 部分概览

```yaml
settings:
  debug: false
  bungeecord: false
  timeout-time: 60
  restart-on-crash: true
  restart-script: ./start.sh
  netty-threads: 4
  sample-count: 12
  player-shuffle: 0
  user-cache-size: 1000
```

---

## debug

| 属性 | 值 |
|------|-----|
| 键名 | `settings.debug` |
| 类型 | 布尔值 |
| 默认值 | `false` |

控制是否启用调试模式。

- `true`：启用调试模式，在控制台输出详细的调试信息
- `false`：禁用调试模式，仅输出常规日志

调试模式会产生大量日志输出，仅建议在排查问题时临时开启。正常运行时应保持关闭以避免日志文件过大。

---

## bungeecord

| 属性 | 值 |
|------|-----|
| 键名 | `settings.bungeecord` |
| 类型 | 布尔值 |
| 默认值 | `false` |

控制是否启用 BungeeCord 模式。这是群组服配置中非常重要的选项。

- `true`：启用 BungeeCord 模式，服务器将信任来自 BungeeCord 代理的玩家信息
- `false`：禁用 BungeeCord 模式，服务器独立验证玩家身份

### 重要安全提示

启用此选项后，服务器会信任代理发送的玩家 IP 和 UUID 信息。如果你的服务器没有在 BungeeCord 代理后面运行，**绝对不要**启用此选项，否则任何人都可以伪造身份连接你的服务器。

配置群组服时，还需要同时：
1. 在 BungeeCord 的 config.yml 中设置 `ip_forward: true`
2. 确保子服务器只能通过 BungeeCord 访问（使用防火墙限制）

---

## timeout-time

| 属性 | 值 |
|------|-----|
| 键名 | `settings.timeout-time` |
| 类型 | 整数 |
| 默认值 | `60` |
| 单位 | 秒 |

设置服务器看门狗（Watchdog）的超时时间。

当服务器主线程在指定时间内没有响应时，看门狗会认为服务器已经卡死，并根据 `restart-on-crash` 的设置决定是否重启服务器。

- 较小的值：更快检测到服务器卡死，但可能在服务器处理大量数据时误判
- 较大的值：给服务器更多处理时间，但卡死后恢复较慢

### 建议值

| 服务器类型 | 建议值 |
|-----------|--------|
| 小型服务器 | 60 |
| 中型服务器 | 90 |
| 大型服务器（有大量实体/红石） | 120 |

---

## restart-on-crash

| 属性 | 值 |
|------|-----|
| 键名 | `settings.restart-on-crash` |
| 类型 | 布尔值 |
| 默认值 | `true` |

控制服务器崩溃时是否自动重启。

- `true`：服务器崩溃后自动执行重启脚本
- `false`：服务器崩溃后停止运行，需要手动重启

此选项需要配合 `restart-script` 使用。自动重启可以减少服务器停机时间，但如果崩溃是由配置错误导致的，可能会陷入重启循环。

---

## restart-script

| 属性 | 值 |
|------|-----|
| 键名 | `settings.restart-script` |
| 类型 | 字符串 |
| 默认值 | `./start.sh` |

指定服务器重启时执行的脚本路径。

此脚本会在以下情况被调用：
- 服务器崩溃且 `restart-on-crash` 为 true
- 执行 `/restart` 命令
- 看门狗检测到服务器无响应

### 配置示例

**Linux 系统：**
```yaml
restart-script: ./start.sh
```

对应的 start.sh 脚本：
```bash
#!/bin/bash
java -Xms4G -Xmx4G -jar server.jar nogui
```

**Windows 系统：**
```yaml
restart-script: ./start.bat
```

对应的 start.bat 脚本：
```batch
@echo off
java -Xms4G -Xmx4G -jar server.jar nogui
```

### 注意事项

- 确保脚本文件存在且有执行权限
- 脚本路径相对于服务端根目录
- 如果脚本不存在，重启功能将无法正常工作

---

## netty-threads

| 属性 | 值 |
|------|-----|
| 键名 | `settings.netty-threads` |
| 类型 | 整数 |
| 默认值 | `4` |

设置 Netty 网络库使用的线程数量。

Netty 负责处理所有网络通信，包括玩家连接、数据包收发等。更多的线程可以提高网络处理能力，但也会消耗更多系统资源。

### 建议值

| 服务器规模 | 建议值 |
|-----------|--------|
| 小型（< 20 人） | 4 |
| 中型（20-50 人） | 4-6 |
| 大型（> 50 人） | 6-8 |

一般情况下保持默认值即可。只有在网络成为瓶颈时才需要调整。

---

## sample-count

| 属性 | 值 |
|------|-----|
| 键名 | `settings.sample-count` |
| 类型 | 整数 |
| 默认值 | `12` |

设置服务器列表中显示的玩家样本数量。

当玩家在多人游戏列表中将鼠标悬停在服务器的玩家数量上时，会显示部分在线玩家的名字。此选项控制显示多少个玩家名字。

- 设置为 `0` 可以完全隐藏玩家列表
- 较大的值会显示更多玩家名字

---

## player-shuffle

| 属性 | 值 |
|------|-----|
| 键名 | `settings.player-shuffle` |
| 类型 | 整数 |
| 默认值 | `0` |
| 单位 | tick |

设置玩家列表的随机打乱间隔。

此选项用于防止某些利用玩家处理顺序的作弊行为。设置为 `0` 表示禁用打乱功能。

- `0`：禁用玩家列表打乱
- `> 0`：每隔指定 tick 数打乱一次玩家处理顺序

一般情况下保持默认值即可。

---

## user-cache-size

| 属性 | 值 |
|------|-----|
| 键名 | `settings.user-cache-size` |
| 类型 | 整数 |
| 默认值 | `1000` |

设置用户缓存的最大条目数。

服务器会缓存玩家的 UUID 和用户名对应关系，以减少对 Mojang 服务器的查询。此选项控制缓存的最大条目数。

- 较大的值可以缓存更多玩家信息，减少网络请求
- 较小的值可以节省内存

对于大多数服务器，默认值 1000 已经足够。只有当你的服务器有大量不同玩家访问时才需要增加。
