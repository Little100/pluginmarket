# 网络设置

本节介绍 `server.properties` 中与网络相关的配置项，包括端口、IP 绑定、数据压缩、查询协议等。

---

## server-port

| 属性 | 值 |
|------|-----|
| 键名 | `server-port` |
| 默认值 | `25565` |
| 可选值 | `1-65535` |

服务器监听的端口号。Minecraft 默认端口为 25565，如果使用默认端口，玩家连接时无需输入端口号。

如果在同一台机器上运行多个服务器，需要为每个服务器分配不同的端口。

### 端口选择建议

- 使用 1024 以上的端口（1024 以下需要管理员权限）
- 避免使用常见服务端口（如 80、443、3306 等）
- 如果需要公网访问，确保防火墙和路由器已开放对应端口

---

## server-ip

| 属性 | 值 |
|------|-----|
| 键名 | `server-ip` |
| 默认值 | （空） |
| 可选值 | IP 地址或留空 |

指定服务器绑定的 IP 地址。留空表示监听所有可用的网络接口。

如果服务器有多个网卡或 IP 地址，可以指定具体的 IP 来限制访问来源。一般情况下保持为空即可。

### 使用场景

- **单网卡服务器**：保持为空
- **多网卡服务器**：指定要监听的网卡 IP
- **本地测试**：可设置为 `127.0.0.1` 仅允许本机访问

---

## network-compression-threshold

| 属性 | 值 |
|------|-----|
| 键名 | `network-compression-threshold` |
| 默认值 | `256` |
| 可选值 | `-1` 到 `65535` |

设置网络数据包压缩的阈值（字节）。

- 大于此值的数据包会被压缩后发送
- 设置为 `-1` 禁用压缩
- 设置为 `0` 压缩所有数据包

### 推荐设置

| 场景 | 推荐值 | 说明 |
|------|--------|------|
| 默认 | `256` | 平衡压缩率和 CPU 开销 |
| 高带宽服务器 | `-1` | 禁用压缩，减少 CPU 负载 |
| 低带宽服务器 | `64` | 更激进的压缩，节省带宽 |

---

## enable-query

| 属性 | 值 |
|------|-----|
| 键名 | `enable-query` |
| 默认值 | `false` |
| 可选值 | `true` / `false` |

是否启用 GameSpy4 查询协议。启用后，外部工具可以通过 UDP 协议查询服务器状态。

### 相关配置

启用 query 后，还需要配置查询端口：

```properties
enable-query=true
query.port=25565
```

### 用途

- 服务器列表网站获取服务器信息
- 监控工具查询服务器状态
- 第三方启动器显示服务器详情

---

## query.port

| 属性 | 值 |
|------|-----|
| 键名 | `query.port` |
| 默认值 | `25565` |
| 可选值 | `1-65535` |

GameSpy4 查询协议使用的 UDP 端口。仅在 `enable-query=true` 时有效。

通常设置为与 `server-port` 相同的值。

---

## enable-status

| 属性 | 值 |
|------|-----|
| 键名 | `enable-status` |
| 默认值 | `true` |
| 可选值 | `true` / `false` |

是否允许客户端在服务器列表中查看服务器状态（在线玩家数、MOTD 等）。

设置为 `false` 后，服务器在列表中会显示为"无法连接"状态，但实际上仍可正常连接。

### 使用场景

- **公开服务器**：保持 `true`
- **私密服务器**：可设置为 `false` 隐藏服务器信息

---

## prevent-proxy-connections

| 属性 | 值 |
|------|-----|
| 键名 | `prevent-proxy-connections` |
| 默认值 | `false` |
| 可选值 | `true` / `false` |

是否阻止通过代理连接的玩家。启用后，服务器会检查玩家 IP 是否与 Mojang 认证服务器记录的 IP 一致。

> ⚠️ 仅在 `online-mode=true` 时有效

### 注意事项

- 可能会误伤使用 VPN 的正常玩家
- 对于使用 BungeeCord/Velocity 的群组服务器，不要启用此选项

---

## rate-limit

| 属性 | 值 |
|------|-----|
| 键名 | `rate-limit` |
| 默认值 | `0` |
| 可选值 | `0` 或正整数 |

限制每个玩家每秒可发送的数据包数量。设置为 `0` 表示不限制。

### 用途

- 防止恶意客户端发送大量数据包
- 减轻服务器负载
- 推荐值：`0`（由反作弊插件处理）或 `500-1000`

---

## 网络配置示例

### 基础配置

```properties
server-port=25565
server-ip=
network-compression-threshold=256
enable-query=false
enable-status=true
```

### 高性能配置

```properties
server-port=25565
server-ip=
network-compression-threshold=-1
enable-query=false
enable-status=true
rate-limit=0
```

### 安全配置

```properties
server-port=25565
server-ip=192.168.1.100
network-compression-threshold=256
enable-query=false
enable-status=false
prevent-proxy-connections=true
rate-limit=500
```
