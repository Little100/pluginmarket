# 性能与安全

本节介绍 `server.properties` 中与性能优化和安全相关的配置项，包括 tick 限制、命令方块、RCON 等设置。

---

## max-tick-time

| 属性 | 值 |
|------|-----|
| 键名 | `max-tick-time` |
| 默认值 | `60000` |
| 可选值 | `-1` 或正整数（毫秒） |

单个 tick 的最大执行时间（毫秒）。如果某个 tick 超过此时间，服务器会认为发生了崩溃并强制停止。

- 默认值 `60000` 表示 60 秒
- 设置为 `-1` 禁用看门狗（不推荐）

### 什么是 Tick？

Minecraft 服务器每秒运行 20 个 tick（TPS = Ticks Per Second）。每个 tick 处理：
- 实体移动和 AI
- 方块更新（红石、作物生长等）
- 玩家输入
- 网络数据包

### 推荐设置

| 场景 | 推荐值 | 说明 |
|------|--------|------|
| 默认 | `60000` | 60 秒超时 |
| 调试 | `-1` | 禁用看门狗，方便调试 |
| 生产 | `60000-120000` | 根据服务器负载调整 |

> ⚠️ 不建议在生产环境禁用看门狗，这可能导致服务器无响应时无法自动重启

---

## enable-command-block

| 属性 | 值 |
|------|-----|
| 键名 | `enable-command-block` |
| 默认值 | `false` |
| 可选值 | `true` / `false` |

是否启用命令方块。

- `true`：命令方块可以执行命令
- `false`：命令方块被禁用

### 安全考虑

命令方块可以执行任何命令，包括危险操作。建议：
- 只在需要时启用
- 限制谁可以放置和编辑命令方块
- 定期检查世界中的命令方块

---

## enable-jmx-monitoring

| 属性 | 值 |
|------|-----|
| 键名 | `enable-jmx-monitoring` |
| 默认值 | `false` |
| 可选值 | `true` / `false` |

是否启用 JMX（Java Management Extensions）监控。

启用后可以使用 JMX 工具（如 JConsole、VisualVM）监控服务器性能。

### 使用方法

1. 设置 `enable-jmx-monitoring=true`
2. 启动服务器时添加 JVM 参数：
   ```
   -Dcom.sun.management.jmxremote
   -Dcom.sun.management.jmxremote.port=9999
   -Dcom.sun.management.jmxremote.authenticate=false
   -Dcom.sun.management.jmxremote.ssl=false
   ```
3. 使用 JConsole 连接到 `localhost:9999`

---

## sync-chunk-writes

| 属性 | 值 |
|------|-----|
| 键名 | `sync-chunk-writes` |
| 默认值 | `true` |
| 可选值 | `true` / `false` |

是否同步写入区块数据。

- `true`：区块数据同步写入磁盘，更安全但可能影响性能
- `false`：异步写入，性能更好但崩溃时可能丢失数据

### 推荐设置

- **SSD 服务器**：`true`（SSD 写入速度快，影响小）
- **HDD 服务器**：可考虑 `false`（但需要做好备份）

---

## 远程控制（RCON）

RCON（Remote Console）允许通过网络远程执行服务器命令。

### enable-rcon

| 属性 | 值 |
|------|-----|
| 键名 | `enable-rcon` |
| 默认值 | `false` |
| 可选值 | `true` / `false` |

是否启用 RCON 远程控制。

### rcon.port

| 属性 | 值 |
|------|-----|
| 键名 | `rcon.port` |
| 默认值 | `25575` |
| 可选值 | `1-65535` |

RCON 服务监听的端口。

### rcon.password

| 属性 | 值 |
|------|-----|
| 键名 | `rcon.password` |
| 默认值 | （空） |
| 可选值 | 任意字符串 |

RCON 连接密码。

> ⚠️ **必须设置强密码！** 空密码或弱密码会导致服务器被入侵

### broadcast-rcon-to-ops

| 属性 | 值 |
|------|-----|
| 键名 | `broadcast-rcon-to-ops` |
| 默认值 | `true` |
| 可选值 | `true` / `false` |

是否将 RCON 执行的命令广播给在线 OP。

### RCON 安全配置示例

```properties
enable-rcon=true
rcon.port=25575
rcon.password=YourStrongPassword123!
broadcast-rcon-to-ops=true
```

### RCON 安全建议

1. 使用强密码（至少 16 位，包含大小写字母、数字、特殊字符）
2. 不要将 RCON 端口暴露到公网
3. 使用防火墙限制 RCON 访问来源
4. 定期更换密码
5. 监控 RCON 连接日志

---

## 文本过滤

### text-filtering-config

| 属性 | 值 |
|------|-----|
| 键名 | `text-filtering-config` |
| 默认值 | （空） |
| 可选值 | 配置文件路径 |

文本过滤配置文件路径。用于过滤聊天中的不当内容。

### log-ips

| 属性 | 值 |
|------|-----|
| 键名 | `log-ips` |
| 默认值 | `true` |
| 可选值 | `true` / `false` |

是否在日志中记录玩家 IP 地址。

- `true`：记录 IP，便于追踪问题玩家
- `false`：不记录 IP，保护玩家隐私

---

## 性能与安全配置示例

### 标准配置

```properties
max-tick-time=60000
enable-command-block=false
enable-jmx-monitoring=false
sync-chunk-writes=true
enable-rcon=false
log-ips=true
```

### 开发/调试配置

```properties
max-tick-time=-1
enable-command-block=true
enable-jmx-monitoring=true
sync-chunk-writes=false
enable-rcon=true
rcon.port=25575
rcon.password=debug123
broadcast-rcon-to-ops=true
log-ips=true
```

### 高安全配置

```properties
max-tick-time=60000
enable-command-block=false
enable-jmx-monitoring=false
sync-chunk-writes=true
enable-rcon=false
log-ips=true
text-filtering-config=
```

### 远程管理配置

```properties
max-tick-time=60000
enable-command-block=false
enable-jmx-monitoring=true
sync-chunk-writes=true
enable-rcon=true
rcon.port=25575
rcon.password=SuperSecureP@ssw0rd!2024
broadcast-rcon-to-ops=true
log-ips=true
```
