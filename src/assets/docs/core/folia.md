# Folia

## 概述

Folia 是由 PaperMC 团队开发的 Minecraft 服务端，基于 Paper 构建。它的核心特性是**区域化多线程**（Regionized Multithreading），能够将游戏世界划分为多个独立区域，每个区域在单独的线程上运行，从而实现真正的多线程处理。

与传统的 Minecraft 服务端不同，Folia 不是简单地将某些任务异步化，而是从根本上改变了服务器的运行方式，使其能够充分利用现代多核 CPU 的性能。

## 特点

### 区域化多线程
- 将世界划分为多个独立的"区域"（Region）
- 每个区域在独立的线程上运行
- 区域之间相互隔离，互不干扰

### 性能优势
- 真正的多线程架构，能够充分利用多核 CPU
- 适合玩家分布广泛的大型服务器
- 在高玩家数量场景下性能提升明显

### 基于 Paper
- 继承 Paper 的所有优化和特性
- 保留 Paper 的配置选项
- 使用相同的构建和部署流程

## 重要限制

在选择 Folia 之前，请务必了解以下限制：

### 插件兼容性问题
- **大部分现有的 Bukkit/Spigot/Paper 插件无法在 Folia 上运行**
- 插件必须专门为 Folia 的多线程架构进行适配
- 需要使用 Folia 专用的 API 进行开发

### 不适合小型服务器
- 对于玩家数量较少的服务器，Folia 的优势无法体现
- 多线程带来的额外开销可能反而降低性能
- 小型服务器建议使用 Paper 或 Purpur

### 开发状态
- Folia 仍在积极开发中
- 可能存在未知的 Bug 或稳定性问题
- 不建议在生产环境中使用，除非有充分的测试

## 支持版本

| Minecraft 版本 | Folia 支持状态 |
|---------------|---------------|
| 1.21.x | ✅ 支持（最新：1.21.11） |
| 1.20.x | ✅ 支持 |
| 1.19.x 及更早 | ❌ 不支持 |

> 注：Folia 仅支持较新的 Minecraft 版本，不提供旧版本支持。

## 下载方式

### 官方下载（推荐）

访问 PaperMC 官方下载页面：

**https://papermc.io/downloads/folia**

在页面中选择对应的 Minecraft 版本，下载最新的构建版本。

### GitHub 仓库

**https://github.com/PaperMC/Folia**

GitHub 仓库提供源代码，但不提供预编译的 JAR 文件。如需从源码构建，请参考仓库中的构建说明。

### 官方文档

**https://docs.papermc.io/folia**

包含详细的配置说明、API 文档和常见问题解答。

## 安装步骤

1. **确认系统要求**
   - Java 21 或更高版本
   - 多核 CPU（建议 4 核以上）
   - 足够的内存（建议 8GB 以上）

2. **下载 Folia**
   - 访问 https://papermc.io/downloads/folia
   - 下载对应 Minecraft 版本的 JAR 文件

3. **创建服务器目录**
   - 创建一个新的文件夹用于存放服务器文件
   - 将下载的 JAR 文件放入该文件夹

4. **首次启动**
   ```bash
   java -Xms4G -Xmx4G -jar folia-1.21.11.jar --nogui
   ```

5. **同意 EULA**
   - 打开生成的 `eula.txt` 文件
   - 将 `eula=false` 改为 `eula=true`

6. **再次启动服务器**
   - 使用相同的启动命令
   - 等待服务器完成初始化

## 适用场景

### 适合使用 Folia 的情况

- 大型公共服务器，玩家数量超过 100 人
- 玩家分布在世界各处，而非集中在一个区域
- 拥有多核高性能 CPU 的服务器硬件
- 所有需要的插件都已适配 Folia
- 有能力处理潜在的技术问题

### 不适合使用 Folia 的情况

- 小型私人服务器或朋友联机
- 玩家主要集中在同一区域活动
- 依赖大量未适配 Folia 的插件
- 追求稳定性的生产环境
- 缺乏技术支持能力

## 插件兼容性说明

### 为什么大多数插件不兼容？

传统的 Bukkit/Spigot/Paper 插件假设服务器在单线程上运行，代码中可能存在：
- 直接访问其他区域的实体或方块
- 使用非线程安全的数据结构
- 依赖同步执行的 API 调用

这些在单线程环境下正常工作的代码，在 Folia 的多线程环境中可能导致数据竞争、崩溃或不可预期的行为。

### 如何判断插件是否兼容？

1. 查看插件的官方说明，确认是否标注支持 Folia
2. 在插件的 GitHub 仓库或发布页面搜索 "Folia" 关键词
3. 查阅 Folia 官方文档中的兼容插件列表
4. 在测试环境中实际运行验证

### Folia 专用 API

开发者需要使用 Folia 提供的专用 API 来确保线程安全：
- 使用区域调度器（Region Scheduler）而非全局调度器
- 避免跨区域直接访问数据
- 使用线程安全的数据结构

## 常见问题

### Q: Folia 和 Paper 有什么区别？

A: Paper 是单线程服务端，所有游戏逻辑在一个主线程上执行。Folia 是多线程服务端，将世界划分为多个区域，每个区域独立运行。Folia 基于 Paper 构建，但架构完全不同。

### Q: 我的服务器应该用 Folia 还是 Paper？

A: 如果你的服务器玩家数量少于 50 人，或者需要使用大量插件，建议使用 Paper。只有在玩家数量多、分布广泛、且所有插件都兼容的情况下，才考虑使用 Folia。

### Q: 为什么我的插件在 Folia 上报错？

A: 大多数现有插件没有针对 Folia 的多线程架构进行适配。你需要寻找该插件的 Folia 兼容版本，或者联系插件作者请求适配。

### Q: Folia 能提升多少性能？

A: 性能提升取决于服务器的具体情况。对于玩家分布广泛的大型服务器，Folia 可以显著提升 TPS 稳定性。但对于小型服务器或玩家集中的服务器，可能看不到明显提升，甚至可能因为多线程开销而略有下降。

### Q: Folia 稳定吗？

A: Folia 仍在积极开发中，虽然已经可以使用，但可能存在未发现的问题。建议在生产环境使用前进行充分测试，并做好数据备份。

### Q: 如何从 Paper 迁移到 Folia？

A: 迁移步骤：
1. 备份所有服务器数据
2. 检查所有插件的 Folia 兼容性
3. 替换不兼容的插件或寻找替代方案
4. 在测试环境中运行 Folia 并验证功能
5. 确认无问题后再迁移生产环境
