# Minecraft 开服常见问题

本文档汇总了 Minecraft 服务器运营过程中的常见问题及解决方案，适合新手服主参考。

---

## 一、基础问题

### Q: 开服需要什么配置的电脑/服务器？

**A:** 服务器配置需求取决于预期在线人数、使用的插件/模组数量以及地图大小。以下是推荐配置：

| 在线人数 | CPU | 内存 | 硬盘 | 带宽 |
|---------|-----|------|------|------|
| 1-5 人 | 双核 2.5GHz+ | 2-4GB | 10GB SSD | 5Mbps 上行 |
| 5-20 人 | 四核 3.0GHz+ | 4-8GB | 20GB SSD | 10Mbps 上行 |
| 20-50 人 | 四核 3.5GHz+ | 8-16GB | 50GB SSD | 20Mbps 上行 |
| 50-100 人 | 六核 3.5GHz+ | 16-32GB | 100GB SSD | 50Mbps 上行 |
| 100+ 人 | 八核 4.0GHz+ | 32GB+ | 200GB+ NVMe | 100Mbps+ 上行 |

**注意事项：**
- Minecraft 服务器主要依赖单核性能，高主频比多核心更重要
- SSD 硬盘对区块加载速度有显著提升
- 模组服通常比插件服需要更多内存
- 上行带宽决定了玩家连接的流畅度

---

### Q: 开服需要花钱吗？

**A:** 这取决于你的开服方式：

**免费方案：**
- 使用自己的电脑开服（仅限局域网或需要内网穿透）
- 使用免费的内网穿透服务（如 Sakura Frp 免费额度）
- 适合小规模朋友联机

**付费方案：**
- 云服务器租用：约 50-500 元/月（根据配置）
- 面板服/游戏服务器托管：约 20-200 元/月
- 独立服务器租用：约 500-2000 元/月
- 域名费用：约 10-100 元/年（可选）

**建议：**
- 新手可以先用自己的电脑测试，熟悉后再考虑租用服务器
- 长期运营建议使用云服务器或专业游戏托管服务

---

### Q: 用什么版本的 Java？

**A:** 不同 Minecraft 版本需要不同的 Java 版本：

| Minecraft 版本 | 最低 Java 版本 | 推荐 Java 版本 |
|---------------|---------------|---------------|
| 1.7.10 及以下 | Java 8 | Java 8 |
| 1.8 - 1.11 | Java 8 | Java 8 |
| 1.12 - 1.16.5 | Java 8 | Java 11 或 Java 8 |
| 1.17 - 1.17.1 | Java 16 | Java 17 |
| 1.18 - 1.20.4 | Java 17 | Java 17 或 Java 21 |
| 1.20.5+ | Java 21 | Java 21 |

**推荐的 Java 发行版：**
- Adoptium (Eclipse Temurin) - 免费、开源、稳定
- Amazon Corretto - 免费、长期支持
- Azul Zulu - 免费、性能优秀
- GraalVM - 可能带来性能提升（需要测试）

**注意：** 不要使用 Oracle JDK 的商业版本，除非你有商业许可证。

---

### Q: Paper/Spigot/Forge 有什么区别？

**A:** 这些是不同类型的服务端，各有特点：

**Bukkit/Spigot/Paper 系列（插件服）：**

| 服务端 | 特点 | 适用场景 |
|-------|------|---------|
| CraftBukkit | 最早的插件服务端，已过时 | 不推荐使用 |
| Spigot | CraftBukkit 的优化版，插件生态丰富 | 一般插件服 |
| Paper | Spigot 的深度优化版，性能更好 | 推荐大多数插件服使用 |
| Purpur | Paper 的扩展版，更多自定义选项 | 需要更多配置选项时 |
| Folia | Paper 的多线程版本 | 大型服务器（实验性） |

**Forge/NeoForge/Fabric 系列（模组服）：**

| 服务端 | 特点 | 适用场景 |
|-------|------|---------|
| Forge | 最主流的模组加载器，模组数量最多 | 大多数模组服 |
| NeoForge | Forge 的分支，1.20.1+ 版本 | 新版本模组服 |
| Fabric | 轻量级模组加载器，启动快 | 轻量模组服、快照版本 |
| Quilt | Fabric 的分支，兼容 Fabric 模组 | 需要额外功能时 |

**混合服务端（插件+模组）：**

| 服务端 | 特点 | 适用场景 |
|-------|------|---------|
| Mohist | Forge + Paper，支持插件和模组 | 需要同时使用插件和模组 |
| CatServer | Forge + Spigot，中文社区维护 | 国内模组插件混合服 |
| Arclight | Forge/Fabric + Paper | 混合服务端 |

---

### Q: 正版和离线模式有什么区别？

**A:** 这涉及到服务器的身份验证方式：

**正版模式（online-mode=true）：**
- 玩家必须拥有正版 Minecraft 账号
- 通过 Mojang/Microsoft 服务器验证身份
- 玩家 UUID 固定，数据不会因改名丢失
- 安全性高，无法冒充他人
- 可以显示玩家皮肤

**离线模式（online-mode=false）：**
- 任何人都可以使用任意用户名加入
- 不进行身份验证
- UUID 基于用户名生成，改名会导致数据丢失
- 存在冒名登录风险，需要安装登录插件
- 无法显示正版皮肤（需要皮肤插件）

**建议：**
- 如果所有玩家都有正版账号，使用正版模式
- 如果有离线玩家，必须安装登录插件（如 AuthMe）保护账号安全
- 可以使用 LuckPerms 等插件区分正版和离线玩家的权限

---

### Q: 服务器能同时装插件和模组吗？

**A:** 可以，但需要使用特定的混合服务端：

**支持插件+模组的服务端：**
- Mohist（Forge + Paper）
- CatServer（Forge + Spigot）
- Arclight（Forge/Fabric + Paper）

**注意事项：**
1. 混合服务端的稳定性不如纯插件服或纯模组服
2. 部分插件可能与模组不兼容
3. 性能开销比单一类型服务端更大
4. 出现问题时排查难度更高
5. 更新速度通常比官方服务端慢

**建议：**
- 如果不是必须，尽量选择纯插件服或纯模组服
- 使用混合服务端前，先在测试环境验证兼容性
- 定期备份，以防出现严重问题

---

## 二、启动与连接问题

### Q: 服务器启动失败怎么办？

**A:** 服务器启动失败通常有以下原因和解决方案：

**1. Java 版本不正确**

错误信息示例：
```
Error: A JNI error has occurred, please check your installation and try again
Exception in thread "main" java.lang.UnsupportedClassVersionError
```

解决方案：
- 检查 Minecraft 版本对应的 Java 版本要求
- 下载并安装正确版本的 Java
- 确保启动脚本使用了正确的 Java 路径

**2. 内存分配不足或过大**

错误信息示例：
```
Error occurred during initialization of VM
Could not reserve enough space for object heap
```

解决方案：
- 检查 -Xmx 参数是否超过系统可用内存
- 32 位 Java 最大只能分配约 1.5GB 内存
- 建议使用 64 位 Java

**3. 端口被占用**

错误信息示例：
```
**** FAILED TO BIND TO PORT!
The exception was: java.net.BindException: Address already in use: bind
```

解决方案：
- 修改 server.properties 中的 server-port
- 或关闭占用该端口的程序

**4. 文件损坏或缺失**

错误信息示例：
```
Error: Unable to access jarfile server.jar
```

解决方案：
- 重新下载服务端文件
- 检查文件路径是否正确
- 确保文件没有被杀毒软件删除

**5. EULA 未同意**

错误信息示例：
```
You need to agree to the EULA in order to run the server.
```

解决方案：
- 打开 eula.txt 文件
- 将 `eula=false` 改为 `eula=true`

**6. 插件/模组错误**

解决方案：
- 查看日志中的具体错误信息
- 尝试移除最近添加的插件/模组
- 使用二分法排查问题插件

---

### Q: 端口被占用怎么办？

**A:** 端口被占用时，可以通过以下方法解决：

**方法一：更换端口**

编辑 `server.properties` 文件：
```properties
server-port=25566
```
将默认的 25565 改为其他未被占用的端口（范围：1024-65535）。

**方法二：查找并关闭占用端口的程序**

Windows 系统：
```cmd
# 查看端口占用
netstat -ano | findstr :25565

# 根据 PID 查看程序名
tasklist | findstr <PID>

# 结束进程
taskkill /PID <PID> /F
```

Linux 系统：
```bash
# 查看端口占用
sudo lsof -i :25565
# 或
sudo netstat -tlnp | grep 25565

# 结束进程
sudo kill -9 <PID>
```

**方法三：重启计算机**

如果无法确定是哪个程序占用，重启计算机可以释放端口。

**常见占用端口的情况：**
- 之前的服务器进程未正常关闭
- 其他 Minecraft 服务器正在运行
- 其他程序恰好使用了相同端口

---

### Q: 朋友连不上我的服务器怎么办？

**A:** 按以下步骤排查：

**第一步：确认服务器正常运行**
- 检查服务器控制台是否有错误信息
- 尝试在本机使用 `localhost` 或 `127.0.0.1` 连接

**第二步：确认网络类型**

你的网络情况决定了连接方式：

| 网络类型 | 局域网连接 | 外网连接 |
|---------|-----------|---------|
| 有公网 IPv4 | 使用内网 IP | 使用公网 IP + 端口映射 |
| 有公网 IPv6 | 使用内网 IP | 使用 IPv6 地址（对方也需要 IPv6） |
| 无公网 IP | 使用内网 IP | 需要内网穿透 |

**第三步：检查防火墙设置**

Windows：
```cmd
# 添加入站规则
netsh advfirewall firewall add rule name="Minecraft Server" dir=in action=allow protocol=TCP localport=25565
netsh advfirewall firewall add rule name="Minecraft Server UDP" dir=in action=allow protocol=UDP localport=25565
```

Linux：
```bash
# UFW
sudo ufw allow 25565/tcp
sudo ufw allow 25565/udp

# firewalld
sudo firewall-cmd --permanent --add-port=25565/tcp
sudo firewall-cmd --permanent --add-port=25565/udp
sudo firewall-cmd --reload
```

**第四步：检查路由器端口映射**

如果你有公网 IP，需要在路由器设置端口转发：
1. 登录路由器管理页面（通常是 192.168.1.1 或 192.168.0.1）
2. 找到"端口转发"或"虚拟服务器"设置
3. 添加规则：外部端口 25565 → 内部 IP:25565

**第五步：使用正确的连接地址**

| 连接场景 | 使用的地址 |
|---------|-----------|
| 同一局域网 | 服务器内网 IP（如 192.168.1.100:25565） |
| 外网（有公网 IP） | 公网 IP:端口 |
| 外网（内网穿透） | 穿透服务提供的地址 |

---

### Q: 连接超时/拒绝连接怎么解决？

**A:** 这两种错误的原因不同：

**"Connection timed out"（连接超时）：**

原因：
- 服务器地址或端口错误
- 防火墙阻止了连接
- 网络不通（路由问题）
- 服务器未运行

排查步骤：
1. 确认服务器地址和端口正确
2. 使用 ping 命令测试网络连通性
3. 检查服务器和客户端的防火墙设置
4. 确认服务器正在运行

**"Connection refused"（拒绝连接）：**

原因：
- 服务器未运行
- 端口号错误
- 服务器绑定了错误的 IP

排查步骤：
1. 确认服务器已启动且没有报错
2. 检查 server.properties 中的 server-port 设置
3. 检查 server-ip 设置（通常应留空）

**测试连接的方法：**

Windows：
```cmd
# 测试端口是否开放
telnet <服务器IP> 25565
```

Linux/Mac：
```bash
# 测试端口是否开放
nc -zv <服务器IP> 25565
```

---

### Q: 如何让外网玩家连接？

**A:** 根据你的网络情况，有以下几种方案：

**方案一：公网 IPv4（最佳方案）**

如果你有公网 IPv4 地址：
1. 在路由器设置端口转发（25565 端口）
2. 开放防火墙端口
3. 将公网 IP 和端口告诉玩家

查看公网 IP：访问 https://ip.sb 或 https://ipinfo.io

**方案二：公网 IPv6**

如果你有公网 IPv6 地址：
1. 确保服务器监听 IPv6（server-ip 留空）
2. 开放防火墙端口
3. 玩家也需要有 IPv6 网络才能连接

**方案三：内网穿透**

如果没有公网 IP：
1. 使用内网穿透服务（如 Sakura Frp、OpenFrp、Ngrok）
2. 配置穿透隧道，将本地端口映射到公网
3. 使用穿透服务提供的地址连接

**方案四：P2P 联机**

适合少数朋友联机：
1. 使用 ZeroTier、Tailscale 等虚拟局域网工具
2. 所有玩家安装并加入同一网络
3. 使用虚拟局域网 IP 连接

---

### Q: "Outdated server/client" 版本不匹配怎么办？

**A:** 这个错误表示客户端和服务器的 Minecraft 版本不一致。

**"Outdated client"（客户端版本过低）：**
- 服务器版本比客户端新
- 解决方案：客户端升级到服务器版本

**"Outdated server"（服务器版本过低）：**
- 客户端版本比服务器新
- 解决方案：客户端降级或服务器升级

**如何切换客户端版本：**

1. 打开 Minecraft 启动器
2. 点击"配置"或"Installations"
3. 创建新配置，选择对应版本
4. 使用该配置启动游戏

**使用 ViaVersion 插件（仅限插件服）：**

ViaVersion 系列插件可以让不同版本的客户端连接：
- ViaVersion：允许新版本客户端连接旧版本服务器
- ViaBackwards：允许旧版本客户端连接新版本服务器
- ViaRewind：支持更老的客户端版本

安装方法：
1. 下载对应插件放入 plugins 文件夹
2. 重启服务器
3. 玩家即可使用不同版本连接

**注意：** 版本跨度过大可能导致功能异常或物品丢失。

---

## 三、性能问题

### Q: 服务器卡顿怎么办？（TPS 低的排查流程）

**A:** 服务器卡顿通常表现为 TPS（每秒游戏刻）低于 20。按以下流程排查：

**第一步：确认 TPS 情况**

使用命令查看 TPS：
- Paper/Spigot：`/tps`
- 安装 Spark 插件：`/spark tps`

TPS 含义：
- 20 TPS：正常
- 15-19 TPS：轻微卡顿
- 10-15 TPS：明显卡顿
- <10 TPS：严重卡顿

**第二步：使用性能分析工具**

安装 Spark 插件进行性能分析：
```
/spark profiler start
# 等待 1-2 分钟
/spark profiler stop
```

分析报告会显示哪些操作消耗了最多时间。

**第三步：常见卡顿原因及解决方案**

| 原因 | 症状 | 解决方案 |
|------|------|---------|
| 实体过多 | 大量生物/掉落物 | 限制生物数量、清理掉落物 |
| 区块加载 | 玩家移动时卡顿 | 使用 SSD、预生成区块 |
| 红石机器 | 特定区域卡顿 | 限制红石更新频率 |
| 插件问题 | 特定操作卡顿 | 排查问题插件 |
| 内存不足 | GC 频繁 | 增加内存、优化 JVM 参数 |
| 世界过大 | 整体卡顿 | 设置世界边界 |

**第四步：优化配置文件**

Paper 服务器可以调整以下配置：

`paper-world-defaults.yml`：
```yaml
chunks:
  max-auto-save-chunks-per-tick: 8
spawn-limits:
  monsters: 50
  animals: 8
  water-animals: 3
  ambient: 1
```

`spigot.yml`：
```yaml
world-settings:
  default:
    entity-activation-range:
      animals: 16
      monsters: 24
      misc: 8
    merge-radius:
      item: 3.5
      exp: 4.0
```

---

### Q: 内存不够用怎么办？

**A:** 内存不足会导致频繁 GC（垃圾回收）和服务器卡顿。

**判断内存是否不足：**
- 使用 `/spark health` 查看内存使用情况
- 观察控制台是否频繁出现 GC 日志
- 服务器周期性卡顿（GC 暂停）

**解决方案：**

**1. 增加分配的内存**

修改启动脚本中的 -Xmx 参数：
```bash
# 分配 4GB 内存
java -Xmx4G -Xms4G -jar server.jar nogui
```

**2. 优化 JVM 参数**

使用 Aikar's Flags（推荐）：
```bash
java -Xmx4G -Xms4G -XX:+UseG1GC -XX:+ParallelRefProcEnabled -XX:MaxGCPauseMillis=200 -XX:+UnlockExperimentalVMOptions -XX:+DisableExplicitGC -XX:+AlwaysPreTouch -XX:G1NewSizePercent=30 -XX:G1MaxNewSizePercent=40 -XX:G1HeapRegionSize=8M -XX:G1ReservePercent=20 -XX:G1HeapWastePercent=5 -XX:G1MixedGCCountTarget=4 -XX:InitiatingHeapOccupancyPercent=15 -XX:G1MixedGCLiveThresholdPercent=90 -XX:G1RSetUpdatingPauseTimePercent=5 -XX:SurvivorRatio=32 -XX:+PerfDisableSharedMem -XX:MaxTenuringThreshold=1 -jar server.jar nogui
```

**3. 减少内存占用**

- 减少视距（view-distance）
- 限制加载的区块数量
- 减少实体数量上限
- 移除不必要的插件
- 设置世界边界

**4. 升级服务器配置**

如果优化后仍然不足，需要升级到更大内存的服务器。

**内存分配建议：**
- 不要分配超过系统可用内存的 80%
- 为操作系统保留至少 1-2GB 内存
- -Xms 和 -Xmx 设置相同的值可以避免内存波动

---

### Q: 如何查看服务器 TPS？

**A:** 有多种方法查看服务器 TPS：

**方法一：内置命令**

Paper/Spigot 服务器：
```
/tps
```

输出示例：
```
TPS from last 1m, 5m, 15m: 20.0, 19.98, 19.95
```

**方法二：使用 Spark 插件（推荐）**

Spark 提供更详细的性能信息：
```
/spark tps
/spark health
```

**方法三：使用 Timings**

Paper 服务器内置 Timings：
```
/timings on
# 运行一段时间后
/timings paste
```

会生成一个网页报告，包含详细的性能分析。

**TPS 数值解读：**

| TPS | 状态 | 说明 |
|-----|------|------|
| 20.0 | 完美 | 服务器运行正常 |
| 18-20 | 良好 | 轻微延迟，玩家基本无感 |
| 15-18 | 一般 | 有明显延迟 |
| 10-15 | 较差 | 严重延迟，需要优化 |
| <10 | 很差 | 几乎无法正常游戏 |

---

### Q: 区块加载慢怎么办？

**A:** 区块加载慢会导致玩家移动时出现卡顿或看到未加载的区块。

**原因分析：**
1. 硬盘读写速度慢（机械硬盘）
2. 视距设置过大
3. 同时加载的区块过多
4. 世界生成器复杂（模组/数据包）

**解决方案：**

**1. 使用 SSD 硬盘**

SSD 的随机读写速度远超机械硬盘，对区块加载有显著提升。

**2. 调整视距**

`server.properties`：
```properties
view-distance=8
simulation-distance=6
```

建议值：
- 小型服务器：view-distance=10, simulation-distance=8
- 中型服务器：view-distance=8, simulation-distance=6
- 大型服务器：view-distance=6, simulation-distance=4

**3. 预生成区块**

使用 Chunky 插件预生成世界：
```
/chunky radius 5000
/chunky start
```

预生成后，玩家探索时不需要实时生成区块。

**4. 优化区块加载配置**

`paper-world-defaults.yml`：
```yaml
chunks:
  auto-save-interval: 6000
  max-auto-save-chunks-per-tick: 8
  prevent-moving-into-unloaded-chunks: true
```

**5. 使用异步区块加载**

Paper 服务器默认启用异步区块加载，确保使用最新版本。

---

### Q: 实体太多导致卡顿怎么处理？

**A:** 实体（生物、掉落物、矿车等）过多是常见的卡顿原因。

**诊断方法：**

使用 Spark 插件：
```
/spark health
```

查看实体数量和分布。

**解决方案：**

**1. 限制生物生成数量**

`bukkit.yml`：
```yaml
spawn-limits:
  monsters: 50
  animals: 10
  water-animals: 5
  water-ambient: 10
  ambient: 5
```

**2. 调整实体激活范围**

`spigot.yml`：
```yaml
entity-activation-range:
  animals: 16
  monsters: 24
  raiders: 48
  misc: 8
  water: 8
  villagers: 32
  flying-monsters: 32
```

**3. 清理掉落物**

使用 ClearLag 插件或命令：
```
/kill @e[type=item]
/kill @e[type=experience_orb]
```

**4. 合并掉落物和经验球**

`spigot.yml`：
```yaml
merge-radius:
  item: 4.0
  exp: 6.0
```

**5. 限制特定实体**

`paper-world-defaults.yml`：
```yaml
entities:
  spawning:
    per-player-mob-spawns: true
    despawn-ranges:
      monster:
        soft: 28
        hard: 96
```

**6. 使用实体限制插件**

- Farm Limiter：限制农场实体数量
- Mob Stacker：堆叠相同生物
- ClearLag：定时清理实体

---

## 四、插件与模组问题

### Q: 插件装了不生效怎么办？

**A:** 插件不生效可能有以下原因：

**1. 插件未正确加载**

检查方法：
- 查看启动日志中是否有插件加载信息
- 使用 `/plugins` 命令查看插件列表
- 红色表示未加载，绿色表示已加载

**2. 版本不兼容**

- 检查插件是否支持当前服务端版本
- 检查插件是否支持当前服务端类型（Spigot/Paper/Folia）

**3. 缺少前置插件**

查看插件说明，安装所需的前置插件：
- Vault（经济插件前置）
- ProtocolLib（协议相关插件前置）
- PlaceholderAPI（变量插件前置）

**4. 配置文件错误**

- 检查配置文件语法（YAML 格式敏感）
- 使用在线 YAML 验证工具检查
- 注意缩进必须使用空格，不能使用 Tab

**5. 权限未配置**

- 检查是否需要给玩家相应权限
- 使用权限插件（如 LuckPerms）配置权限

**排查步骤：**
1. 查看控制台启动日志
2. 检查 `/plugins` 列表
3. 查看插件配置文件
4. 检查前置依赖
5. 查看插件文档

---

### Q: 插件之间冲突怎么排查？

**A:** 插件冲突是常见问题，按以下方法排查：

**症状识别：**
- 服务器启动报错
- 某些功能异常
- 命令冲突
- 服务器崩溃

**排查方法：**

**方法一：二分法**

1. 移除一半插件，测试问题是否存在
2. 如果问题消失，问题在移除的那一半
3. 如果问题仍在，问题在保留的那一半
4. 重复以上步骤，直到找到问题插件

**方法二：逐个添加**

1. 移除所有插件
2. 逐个添加插件并重启测试
3. 当问题出现时，最后添加的插件可能是问题所在

**方法三：查看日志**

仔细阅读错误日志，通常会指出是哪个插件出错：
```
[ERROR] [PluginName] An error occurred...
```

**常见冲突类型：**

| 冲突类型 | 症状 | 解决方案 |
|---------|------|---------|
| 命令冲突 | 命令执行错误的功能 | 在配置中修改命令别名 |
| 事件冲突 | 功能相互干扰 | 调整插件优先级或移除其一 |
| 数据库冲突 | 数据异常 | 使用不同的数据库表 |
| 依赖冲突 | 启动报错 | 更新到兼容版本 |

---

### Q: 模组客户端和服务端不一致怎么办？

**A:** 模组服需要客户端和服务端安装相同的模组。

**错误信息示例：**
```
Mod rejections: [mod_name] - 版本不匹配
```

**解决方案：**

**1. 确保模组版本一致**

- 服务端和客户端使用完全相同版本的模组
- 建议服主提供整合包给玩家下载

**2. 区分客户端模组和服务端模组**

| 模组类型 | 安装位置 | 示例 |
|---------|---------|------|
| 双端模组 | 客户端 + 服务端 | 大多数内容模组 |
| 仅客户端 | 仅客户端 | 光影、小地图、优化模组 |
| 仅服务端 | 仅服务端 | 部分管理模组 |

**3. 制作整合包**

推荐使用 CurseForge 或 Modrinth 发布整合包：
1. 导出服务端模组列表
2. 创建客户端整合包
3. 提供下载链接给玩家

**4. 使用模组同步工具**

- ServerPackCreator：自动生成服务端包
- 部分启动器支持自动同步模组

---

### Q: /reload 和重启服务器有什么区别？

**A:** 这是一个重要的问题，很多新手会滥用 /reload 命令。

**/reload 命令：**
- 重新加载插件配置文件
- 不会完全卸载和重新加载插件
- 可能导致内存泄漏
- 可能导致插件状态异常
- 可能导致数据丢失

**重启服务器：**
- 完全关闭并重新启动服务器
- 所有插件正确卸载和加载
- 内存完全释放
- 状态完全重置

**为什么不推荐使用 /reload：**

1. **内存泄漏**：插件可能无法正确释放资源
2. **状态异常**：监听器可能重复注册
3. **数据问题**：缓存数据可能不一致
4. **不稳定**：部分插件不支持热重载

**正确做法：**

- 修改配置后，使用插件自带的重载命令（如 `/pluginname reload`）
- 如果没有专用重载命令，重启服务器
- 添加或删除插件后，必须重启服务器

**安全的配置重载：**
```
# 使用插件自带命令
/lp reload          # LuckPerms
/essentials reload  # Essentials
/worldguard reload  # WorldGuard
```

---

### Q: 如何查看插件报错日志？

**A:** 日志是排查问题的关键。

**日志文件位置：**
- 最新日志：`logs/latest.log`
- 历史日志：`logs/` 目录下的 `.log.gz` 文件

**查看方法：**

**Windows：**
```cmd
# 查看最新日志
type logs\latest.log

# 实时查看日志
powershell Get-Content logs\latest.log -Wait
```

**Linux：**
```bash
# 查看最新日志
cat logs/latest.log

# 实时查看日志
tail -f logs/latest.log

# 搜索错误信息
grep -i "error" logs/latest.log
```

**日志级别说明：**

| 级别 | 含义 | 处理方式 |
|------|------|---------|
| INFO | 普通信息 | 无需处理 |
| WARN | 警告 | 关注但通常不影响运行 |
| ERROR | 错误 | 需要排查解决 |
| FATAL | 致命错误 | 导致服务器无法运行 |

**常见错误类型：**

```
# 空指针异常
java.lang.NullPointerException

# 类找不到（版本不兼容）
java.lang.NoClassDefFoundError

# 配置文件错误
org.yaml.snakeyaml.scanner.ScannerException
```

**排查建议：**
1. 搜索 "ERROR" 或 "Exception" 关键词
2. 查看错误发生的时间点
3. 查看错误堆栈中涉及的插件名称
4. 将错误信息发给插件作者或在论坛求助

---

## 五、世界与数据问题

### Q: 如何重置地图/世界？

**A:** 重置世界需要删除世界文件夹。

**重置主世界：**

1. 关闭服务器
2. 删除以下文件夹：
   - `world/`（主世界）
   - `world_nether/`（下界）
   - `world_the_end/`（末地）
3. 重新启动服务器，会自动生成新世界

**仅重置下界或末地：**

只删除对应的文件夹即可：
- 下界：`world_nether/`
- 末地：`world_the_end/`

**保留玩家数据但重置地图：**

1. 备份 `world/playerdata/` 文件夹
2. 删除世界文件夹
3. 启动服务器生成新世界
4. 关闭服务器
5. 将备份的 `playerdata/` 复制回去
6. 重新启动服务器

**注意：** 玩家坐标会保留，可能出现在新世界的危险位置。

**更换世界种子：**

编辑 `server.properties`：
```properties
level-seed=新种子
```

然后删除旧世界文件夹并重启。

---

### Q: 如何导入已有的单人存档？

**A:** 单人存档可以直接用作服务器世界。

**步骤：**

1. 找到单人存档位置：
   - Windows：`%appdata%\.minecraft\saves\存档名称`
   - Linux：`~/.minecraft/saves/存档名称`
   - Mac：`~/Library/Application Support/minecraft/saves/存档名称`

2. 关闭服务器

3. 将存档文件夹复制到服务器目录

4. 重命名为 `world`（或修改 server.properties 中的 level-name）

5. 编辑 `server.properties`：
```properties
level-name=world
```

6. 启动服务器

**注意事项：**
- 确保 Minecraft 版本匹配
- 单人存档的模组需要在服务端也安装
- 首次加载可能需要较长时间转换数据

---

### Q: 玩家数据丢失怎么办？

**A:** 玩家数据丢失可能有以下原因和解决方案：

**原因分析：**

1. **UUID 变化**（离线服务器改名）
2. **数据文件损坏**
3. **误删除数据文件**
4. **插件数据库问题**

**恢复方法：**

**方法一：从备份恢复**

如果有备份，从备份中恢复玩家数据：
- 玩家数据位置：`world/playerdata/<UUID>.dat`
- 玩家统计：`world/stats/<UUID>.json`
- 玩家进度：`world/advancements/<UUID>.json`

**方法二：查找旧 UUID 数据**

如果是 UUID 变化导致：
1. 在 `world/playerdata/` 中找到旧的 `.dat` 文件
2. 使用 NBT 编辑器查看确认是该玩家的数据
3. 重命名为新 UUID

**方法三：使用插件恢复**

部分插件有数据恢复功能：
- Essentials：`/seen <玩家>` 查看玩家信息
- LuckPerms：权限数据独立存储，不受影响

**预防措施：**
- 定期备份服务器
- 使用正版模式或登录插件固定 UUID
- 使用数据库存储重要数据

---

### Q: 如何迁移服务器（换电脑/换服务商）？

**A:** 服务器迁移需要转移所有数据文件。

**需要迁移的文件：**

| 文件/文件夹 | 内容 | 重要性 |
|------------|------|--------|
| `world/` | 主世界数据 | 必须 |
| `world_nether/` | 下界数据 | 必须 |
| `world_the_end/` | 末地数据 | 必须 |
| `plugins/` | 插件及配置 | 必须 |
| `server.properties` | 服务器配置 | 必须 |
| `bukkit.yml` | Bukkit 配置 | 推荐 |
| `spigot.yml` | Spigot 配置 | 推荐 |
| `paper.yml` | Paper 配置 | 推荐 |
| `ops.json` | OP 列表 | 推荐 |
| `whitelist.json` | 白名单 | 推荐 |
| `banned-*.json` | 封禁列表 | 推荐 |

**迁移步骤：**

1. 在旧服务器执行 `/save-all` 保存数据
2. 关闭旧服务器
3. 打包所有需要迁移的文件
4. 传输到新服务器
5. 在新服务器安装相同版本的 Java
6. 下载相同版本的服务端核心
7. 解压迁移的文件
8. 检查并修改配置（如 IP 绑定、端口等）
9. 启动新服务器测试

**传输方法：**
- 小文件：直接下载上传
- 大文件：使用 SFTP/SCP
- 超大文件：使用 rsync 增量同步

---

### Q: 如何降级/升级 MC 版本？

**A:** 版本变更需要谨慎操作，可能导致数据丢失。

**升级版本：**

1. **备份所有数据**（重要！）
2. 下载新版本服务端
3. 替换服务端文件
4. 更新插件到兼容版本
5. 启动服务器，世界会自动转换

**升级注意事项：**
- 部分插件可能不兼容新版本
- 世界数据会自动升级，无法回退
- 建议先在测试环境验证

**降级版本（不推荐）：**

降级可能导致数据丢失或损坏，因为：
- 新版本的方块/物品在旧版本不存在
- 世界格式可能不兼容
- 玩家数据格式可能变化

**如果必须降级：**

1. 备份所有数据
2. 使用 MCEdit 或类似工具转换世界
3. 手动处理不兼容的数据
4. 接受可能的数据丢失

**跨大版本升级建议：**
- 1.12 → 1.13：世界扁平化，变化较大
- 1.16 → 1.17：世界高度变化
- 1.18+：洞穴生成变化

建议逐版本升级，每次升级后测试确认无问题。

---

## 六、权限与管理问题

### Q: 如何给自己 OP 权限？

**A:** OP（Operator）是服务器管理员权限。

**方法一：控制台命令**

在服务器控制台输入（不需要斜杠）：
```
op 玩家名
```

**方法二：编辑 ops.json**

编辑服务器目录下的 `ops.json` 文件：
```json
[
  {
    "uuid": "玩家UUID",
    "name": "玩家名",
    "level": 4,
    "bypassesPlayerLimit": true
  }
]
```

OP 等级说明：
- Level 1：可以绕过出生点保护
- Level 2：可以使用单人游戏作弊命令
- Level 3：可以使用多人游戏管理命令
- Level 4：可以使用所有命令，包括 /stop

**方法三：使用权限插件**

推荐使用 LuckPerms 进行更精细的权限管理：
```
/lp user <玩家> permission set * true
```

**注意：** 不建议给普通管理员 OP 权限，应使用权限插件分配具体权限。

---

### Q: 如何封禁/解封玩家？

**A:** 服务器提供多种封禁方式。

**封禁玩家账号：**
```
/ban <玩家名> [原因]
```

**封禁 IP 地址：**
```
/ban-ip <IP地址或玩家名> [原因]
```

**临时封禁（需要插件）：**

使用 Essentials 插件：
```
/tempban <玩家名> <时间> [原因]
# 示例：/tempban Steve 7d 作弊
```

**解除封禁：**
```
/pardon <玩家名>      # 解除账号封禁
/pardon-ip <IP地址>   # 解除 IP 封禁
```

**查看封禁列表：**
- 账号封禁：`banned-players.json`
- IP 封禁：`banned-ips.json`

**踢出玩家（不封禁）：**
```
/kick <玩家名> [原因]
```

---

### Q: 如何设置管理员和普通玩家的权限？

**A:** 推荐使用 LuckPerms 插件进行权限管理。

**安装 LuckPerms：**
1. 下载 LuckPerms 插件
2. 放入 plugins 文件夹
3. 重启服务器

**基本概念：**
- 权限节点：如 `essentials.home`
- 权限组：如 `admin`、`vip`、`default`
- 继承：子组可以继承父组的权限

**创建权限组：**
```
/lp creategroup admin
/lp creategroup vip
```

**设置组权限：**
```
/lp group admin permission set essentials.* true
/lp group vip permission set essentials.home true
```

**将玩家添加到组：**
```
/lp user <玩家> parent set admin
```

**设置默认组：**
```
/lp group default permission set essentials.help true
```

**权限继承：**
```
/lp group vip parent add default
/lp group admin parent add vip
```

---

### Q: 如何修改服务器 MOTD？

**A:** MOTD（Message of the Day）是服务器列表显示的描述文字。

**方法一：修改 server.properties**

编辑 `server.properties` 文件：
```properties
motd=欢迎来到我的服务器！
```

支持颜色代码（使用 \u00A7 或 §）：
```properties
motd=\u00A7a欢迎来到 \u00A7b我的服务器！
```

**方法二：使用插件**

使用 ServerListPlus 或类似插件可以实现：
- 多行 MOTD
- 随机 MOTD
- 显示在线人数
- 自定义玩家数量显示

**颜色代码参考：**

| 代码 | 颜色 | 代码 | 颜色 |
|------|------|------|------|
| §0 | 黑色 | §8 | 深灰 |
| §1 | 深蓝 | §9 | 蓝色 |
| §2 | 深绿 | §a | 绿色 |
| §3 | 深青 | §b | 青色 |
| §4 | 深红 | §c | 红色 |
| §5 | 紫色 | §d | 粉色 |
| §6 | 金色 | §e | 黄色 |
| §7 | 灰色 | §f | 白色 |

**格式代码：**
- §l：粗体
- §o：斜体
- §n：下划线
- §m：删除线
- §r：重置格式

---

### Q: 如何设置服务器图标？

**A:** 服务器图标显示在服务器列表中。

**要求：**
- 文件名：`server-icon.png`
- 尺寸：64×64 像素
- 格式：PNG

**设置步骤：**

1. 准备一张 64×64 的 PNG 图片
2. 命名为 `server-icon.png`
3. 放置在服务器根目录（与 server.jar 同级）
4. 重启服务器

**图片处理建议：**
- 使用图片编辑软件调整尺寸
- 在线工具：https://www.iloveimg.com/resize-image
- 确保图片清晰，避免过于复杂的图案

**常见问题：**
- 图标不显示：检查文件名和尺寸是否正确
- 图标模糊：确保原图质量足够高
- 需要重启服务器才能生效

---

## 七、安全问题

### Q: 服务器被攻击了怎么办？

**A:** Minecraft 服务器可能遭受多种类型的攻击。

**常见攻击类型：**

| 攻击类型 | 症状 | 应对措施 |
|---------|------|---------|
| DDoS/DoS | 服务器无法连接、带宽耗尽 | 使用高防服务器、CDN |
| Bot 攻击 | 大量假玩家加入 | 安装反机器人插件 |
| 漏洞利用 | 服务器崩溃、数据被篡改 | 及时更新、安装安全插件 |
| 暴力破解 | 账号被盗（离线服务器） | 使用登录插件、限制尝试次数 |

**紧急应对措施：**

1. **启用白名单**
```
/whitelist on
```

2. **封禁攻击 IP**
```
/ban-ip <IP地址>
```

3. **联系服务商**
如果是 DDoS 攻击，联系服务器提供商寻求帮助。

**预防措施：**

1. **安装防护插件**
   - AntiBot：防止机器人攻击
   - IPWhitelist：IP 白名单
   - BotSentry：高级反机器人

2. **使用代理/CDN**
   - TCPShield：免费 DDoS 防护
   - Cloudflare Spectrum：付费方案

3. **隐藏真实 IP**
   - 使用 SRV 记录
   - 通过代理转发流量

4. **定期备份**
   - 即使被攻击也能快速恢复

---

### Q: 如何防止熊孩子破坏？

**A:** 防止恶意破坏需要多层防护。

**基础防护：**

1. **安装领地插件**
   - GriefPrevention：自动保护玩家建筑
   - WorldGuard：区域保护
   - Residence：领地系统

2. **安装回滚插件**
   - CoreProtect：记录所有操作，支持回滚
   - Prism：类似功能

3. **安装反作弊插件**
   - Vulcan：综合反作弊
   - Matrix：轻量级反作弊

**WorldGuard 基础配置：**

保护出生点区域：
```
/region define spawn
/region flag spawn pvp deny
/region flag spawn block-break deny
/region flag spawn block-place deny
```

**CoreProtect 使用：**

查看方块操作记录：
```
/co inspect
# 然后点击方块查看历史
```

回滚特定玩家的操作：
```
/co rollback u:<玩家名> t:<时间> r:<范围>
# 示例：/co rollback u:Steve t:1h r:50
```

**管理建议：**

1. 新玩家设置观察期
2. 重要区域设置权限保护
3. 定期检查日志
4. 建立举报机制

---

### Q: 离线服务器如何防止冒名登录？

**A:** 离线服务器必须安装登录插件保护账号安全。

**推荐登录插件：**

| 插件 | 特点 |
|------|------|
| AuthMe | 最流行，功能完善 |
| nLogin | 高性能，支持 Velocity |
| LockLogin | 现代化，多功能 |

**AuthMe 基础配置：**

`plugins/AuthMe/config.yml`：
```yaml
settings:
  registration:
    enabled: true
    force: true
  security:
    minPasswordLength: 6
    passwordMaxLength: 30
  restrictions:
    allowedNicknameCharacters: '[a-zA-Z0-9_]*'
    maxNicknameLength: 16
    minNicknameLength: 3
```

**安全建议：**

1. **强制注册**
   - 新玩家必须注册才能游玩

2. **密码要求**
   - 设置最小密码长度
   - 禁止简单密码

3. **登录限制**
   - 限制登录尝试次数
   - 登录超时自动踢出

4. **IP 绑定**
   - 可选择绑定 IP，防止异地登录

5. **二次验证**
   - 部分插件支持邮箱验证或 2FA

**防止用户名欺骗：**

限制用户名格式，防止使用特殊字符冒充他人：
```yaml
allowedNicknameCharacters: '[a-zA-Z0-9_]*'
```

**正版玩家优化：**

可以让正版玩家跳过登录：
```yaml
DataSource:
  useVeryGames: false
Hooks:
  bungeecord: false
  multiverse: false
```

或使用 FastLogin 插件自动登录正版玩家。
