# 性能优化

## 概述

Minecraft 服务器的性能优化是服务器管理中最重要的工作之一。一个运行流畅的服务器能够为玩家提供良好的游戏体验，而性能不佳的服务器则会导致卡顿、延迟甚至崩溃。

### 为什么需要性能优化

Minecraft 服务器需要在每秒内完成大量计算任务，包括：
- 处理玩家的移动、交互和操作
- 更新所有已加载区块中的方块状态
- 计算实体（生物、掉落物等）的行为和移动
- 处理红石电路的逻辑运算
- 执行插件和模组的代码
- 处理网络数据包的收发

当这些任务的计算量超过服务器的处理能力时，服务器就会出现卡顿。通过合理的优化配置，可以在保持游戏体验的前提下，显著降低服务器的资源消耗。

### TPS 和 MSPT

理解 TPS 和 MSPT 这两个概念对于服务器性能优化至关重要。

**TPS（Ticks Per Second）**

TPS 表示服务器每秒执行的游戏刻数。Minecraft 的设计目标是每秒运行 20 个游戏刻，即 TPS = 20。

- TPS = 20：服务器运行正常
- TPS = 15-19：轻微卡顿，玩家可能感知不明显
- TPS = 10-14：明显卡顿，游戏体验受影响
- TPS < 10：严重卡顿，游戏几乎无法正常进行

**MSPT（Milliseconds Per Tick）**

MSPT 表示服务器处理每个游戏刻所需的毫秒数。由于每秒需要处理 20 个游戏刻，因此每个游戏刻的可用时间为 1000ms ÷ 20 = 50ms。

- MSPT < 50ms：服务器有余力，TPS 保持 20
- MSPT = 50ms：服务器刚好满载
- MSPT > 50ms：服务器过载，TPS 开始下降

MSPT 比 TPS 更能准确反映服务器的性能状态。例如，当 MSPT 为 45ms 时，TPS 仍然是 20，但服务器已经接近满载；而当 MSPT 为 30ms 时，服务器还有较大的性能余量。

## 性能诊断

在进行优化之前，首先需要诊断服务器的性能状况，找出导致卡顿的原因。

### /tps 命令

大多数 Bukkit 系服务端都内置了 `/tps` 命令，用于查看服务器的 TPS。

```
/tps
```

输出示例：
```
TPS from last 1m, 5m, 15m: 20.0, 19.98, 19.95
```

这三个数值分别表示过去 1 分钟、5 分钟和 15 分钟的平均 TPS。

### /mspt 命令（Paper）

Paper 服务端提供了 `/mspt` 命令，可以查看更详细的性能数据。

```
/mspt
```

输出示例：
```
Server tick times (avg/min/max) from last 5s, 10s, 1m:
◆ 23.45/18.32/45.67 ms from last 5s
◆ 24.12/17.89/48.23 ms from last 10s
◆ 22.87/15.43/52.34 ms from last 1m
```

这个命令显示了平均、最小和最大 MSPT 值，能够更准确地反映服务器的性能波动情况。

### Spark 插件

Spark 是目前最推荐的 Minecraft 服务器性能分析工具。它由 Lucko（LuckPerms 的作者）开发，功能强大且易于使用。

#### 安装

1. 从 [SparkMC](https://spark.lucko.me/download) 下载对应服务端版本的插件
2. 将下载的 jar 文件放入 `plugins` 文件夹
3. 重启服务器

#### 基本命令

**查看 TPS 和性能概况：**

```
/spark tps
```

输出包含 TPS、MSPT、CPU 使用率等信息，比内置命令更加详细。

**查看服务器健康状态：**

```
/spark health
```

显示服务器的整体健康状况，包括内存使用、垃圾回收等信息。

#### 性能分析（Profiler）

Spark 的核心功能是性能分析器，它可以记录服务器在一段时间内的运行情况，并生成详细的分析报告。

**启动性能分析：**

```
/spark profiler start
```

**停止分析并生成报告：**

```
/spark profiler stop
```

执行停止命令后，Spark 会生成一个在线报告链接。打开链接即可查看详细的性能分析结果。

**指定分析时间：**

```
/spark profiler start --timeout 300
```

这会在 300 秒（5 分钟）后自动停止分析并生成报告。

#### 阅读 Spark 报告

Spark 报告以火焰图（Flame Graph）的形式展示性能数据。

**火焰图解读：**

- 横轴表示采样次数的占比，越宽表示该操作占用的时间越多
- 纵轴表示调用栈的深度，从下到上是调用关系
- 点击某个方块可以展开查看更详细的调用信息

**常见的性能瓶颈标识：**

- `tickEntities`：实体处理占用过多时间，需要优化实体数量或激活范围
- `tickTileEntities`：方块实体（如漏斗、熔炉）处理耗时，可能需要减少这类方块
- `doTick` 下的插件名称：某个插件占用了大量处理时间
- `tickChunks`：区块处理耗时，可能需要减少视距或模拟距离

**分析步骤：**

1. 找到占用时间最多的顶层方法
2. 逐层展开，找到具体的耗时操作
3. 根据分析结果针对性地进行优化

### Timings（Paper 内置）

Paper 服务端内置了 Timings 系统，但由于 Spark 功能更强大且更易于使用，建议优先使用 Spark。

**启动 Timings：**

```
/timings on
```

**生成报告：**

```
/timings report
```

Timings 报告会上传到 timings.aikar.co 网站，提供类似的性能分析功能。

## 硬件优化

硬件是服务器性能的基础。选择合适的硬件配置可以从根本上提升服务器性能。

### CPU

**单核性能比核心数更重要**

Minecraft 服务器的主游戏逻辑运行在单个线程上，这意味着服务器的性能主要取决于 CPU 的单核性能，而非核心数量。

- 优先选择单核性能高的 CPU
- 高主频（4GHz 以上）比多核心更有价值
- Intel 的高频 CPU 或 AMD 的 Ryzen 系列都是不错的选择

**推荐配置：**

| 服务器规模 | 推荐 CPU |
|-----------|---------|
| 小型（1-20 人） | 任意现代 CPU，主频 3GHz 以上 |
| 中型（20-50 人） | Intel i5/i7 或 AMD Ryzen 5/7，主频 4GHz 以上 |
| 大型（50-100 人） | Intel i7/i9 或 AMD Ryzen 7/9，主频 4.5GHz 以上 |
| 超大型（100+ 人） | 高端 CPU + 多服务器分流 |

### 内存

**推荐内存量**

内存需求取决于玩家数量、插件数量和世界大小。

| 服务器规模 | 推荐内存 |
|-----------|---------|
| 小型（1-20 人，少量插件） | 4-6 GB |
| 中型（20-50 人，中等插件） | 6-10 GB |
| 大型（50-100 人，大量插件） | 10-16 GB |
| 超大型（100+ 人） | 16 GB 以上 |

**不要分配过多内存**

分配过多内存反而可能导致性能问题：

- 过大的堆内存会导致垃圾回收（GC）时间变长
- GC 暂停时间过长会造成服务器卡顿
- 建议为操作系统和其他进程预留至少 1-2 GB 内存

### 磁盘

**SSD 是必需的**

Minecraft 服务器需要频繁读写世界数据，磁盘 I/O 性能直接影响服务器响应速度。

- **HDD（机械硬盘）**：不推荐，会导致区块加载缓慢和保存延迟
- **SATA SSD**：基本要求，能够满足大多数服务器需求
- **NVMe SSD**：推荐，提供更快的读写速度，特别适合大型服务器

### 网络

**带宽需求估算**

Minecraft 服务器的带宽需求相对较低，但稳定性很重要。

- 每个玩家大约需要 50-100 Kbps 的带宽
- 20 人服务器：约 2 Mbps
- 50 人服务器：约 5 Mbps
- 100 人服务器：约 10 Mbps

**网络质量要求：**

- 低延迟比高带宽更重要
- 选择网络稳定的服务器提供商
- 尽量选择距离目标玩家群体较近的服务器位置

## JVM 优化

Java 虚拟机（JVM）的配置对服务器性能有显著影响。合理的 JVM 参数可以优化内存管理和垃圾回收。

> 详细的 JVM 启动参数配置请参阅 [JVM 启动参数](../java/JVM启动参数.md)。

### Aikar's Flags

Aikar's Flags 是 Minecraft 社区广泛使用的 JVM 优化参数集，由 PaperMC 团队成员 Aikar 整理。

**基本启动命令（8GB 内存示例）：**

```bash
java -Xms8G -Xmx8G -XX:+UseG1GC -XX:+ParallelRefProcEnabled -XX:MaxGCPauseMillis=200 -XX:+UnlockExperimentalVMOptions -XX:+DisableExplicitGC -XX:+AlwaysPreTouch -XX:G1NewSizePercent=30 -XX:G1MaxNewSizePercent=40 -XX:G1HeapRegionSize=8M -XX:G1ReservePercent=20 -XX:G1HeapWastePercent=5 -XX:G1MixedGCCountTarget=4 -XX:InitiatingHeapOccupancyPercent=15 -XX:G1MixedGCLiveThresholdPercent=90 -XX:G1RSetUpdatingPauseTimePercent=5 -XX:SurvivorRatio=32 -XX:+PerfDisableSharedMem -XX:MaxTenuringThreshold=1 -Dusing.aikars.flags=https://mcflags.emc.gs -Daikars.new.flags=true -jar server.jar nogui
```

### 内存分配建议

- **-Xms 和 -Xmx 设置相同的值**：避免堆内存动态调整带来的性能开销
- **不要超过 12-16 GB**：过大的堆内存会导致 GC 暂停时间过长
- **为系统预留内存**：总内存减去分配给 JVM 的内存后，应至少剩余 1-2 GB

## 服务端配置优化汇总

以下是各配置文件中最重要的性能优化参数汇总。

### server.properties

| 参数 | 默认值 | 推荐值 | 说明 |
|-----|-------|-------|------|
| `view-distance` | 10 | 6-8 | 服务器发送给客户端的区块视距 |
| `simulation-distance` | 10 | 4-6 | 实体和方块更新的模拟距离 |
| `network-compression-threshold` | 256 | 256 | 网络压缩阈值，保持默认即可 |

**view-distance 和 simulation-distance 的区别：**

- `view-distance`：决定玩家能看到多远的区块，影响视觉效果
- `simulation-distance`：决定多远范围内的实体和方块会被更新，直接影响性能

建议将 `simulation-distance` 设置得比 `view-distance` 小，这样玩家可以看到较远的地形，但只有近处的实体会被处理。

### bukkit.yml

```yaml
spawn-limits:
  monsters: 50        # 默认 70，减少怪物生成
  animals: 8          # 默认 10
  water-animals: 3    # 默认 5
  water-ambient: 10   # 默认 20
  water-underground-creature: 3  # 默认 5
  axolotls: 3         # 默认 5
  ambient: 1          # 默认 15，蝙蝠等环境生物

ticks-per:
  animal-spawns: 400      # 默认 400
  monster-spawns: 1       # 默认 1
  water-spawns: 1         # 默认 1
  water-ambient-spawns: 1 # 默认 1
  water-underground-creature-spawns: 1
  axolotl-spawns: 1
  ambient-spawns: 1
  autosave: 6000          # 默认 6000（5 分钟）
```

**spawn-limits 说明：**

这些值表示每个世界中每种生物类型的最大数量上限。降低这些值可以显著减少实体数量，从而提升性能。

### spigot.yml

```yaml
world-settings:
  default:
    mob-spawn-range: 6          # 默认 8，生物生成范围
    entity-activation-range:
      animals: 16               # 默认 32
      monsters: 24              # 默认 32
      raiders: 48               # 默认 48
      misc: 8                   # 默认 16
      water: 8                  # 默认 16
      villagers: 16             # 默认 32
      flying-monsters: 32       # 默认 32
    entity-tracking-range:
      players: 48               # 默认 48
      animals: 48               # 默认 48
      monsters: 48              # 默认 48
      misc: 32                  # 默认 32
      other: 64                 # 默认 64
    merge-radius:
      item: 4.0                 # 默认 2.5，掉落物合并半径
      exp: 6.0                  # 默认 3.0，经验球合并半径
    nerf-spawner-mobs: false    # 设为 true 可禁用刷怪笼生物的 AI
    hopper-transfer: 8          # 默认 8，漏斗传输间隔（tick）
    hopper-check: 1             # 默认 1，漏斗检查间隔（tick）
```

**entity-activation-range 说明：**

实体激活范围决定了多远距离内的实体会执行完整的 AI 计算。超出此范围的实体会进入"休眠"状态，大幅降低 CPU 占用。

### paper-world-defaults.yml

```yaml
chunks:
  delay-chunk-unloads-by: 10s           # 默认 10s，延迟卸载区块
  max-auto-save-chunks-per-tick: 24     # 默认 24，每 tick 最大自动保存区块数
  prevent-moving-into-unloaded-chunks: true  # 防止玩家进入未加载区块
  entity-per-chunk-save-limit:          # 每区块实体保存限制
    experience_orb: 16
    arrow: 16
    ender_pearl: 8
    snowball: 8

entities:
  armor-stands:
    do-collision-entity-lookups: false  # 禁用盔甲架碰撞检测
    tick: false                         # 禁用盔甲架 tick
  spawning:
    despawn-ranges:
      ambient:
        hard: 72
        soft: 30
      axolotls:
        hard: 72
        soft: 30
      creature:
        hard: 72
        soft: 30
      misc:
        hard: 72
        soft: 30
      monster:
        hard: 72
        soft: 30
      underground_water_creature:
        hard: 72
        soft: 30
      water_ambient:
        hard: 72
        soft: 30
      water_creature:
        hard: 72
        soft: 30

hopper:
  cooldown-when-full: true              # 漏斗满时启用冷却
  disable-move-event: false             # 禁用漏斗移动事件（可能影响保护插件）
  ignore-occluding-blocks: false        # 忽略遮挡方块

tick-rates:
  behavior:
    villager:
      validatenearbypoi: 60             # 村民验证工作站频率
  sensor:
    villager:
      secondarypoisensor: 80            # 村民次要 POI 传感器频率
      nearestbedsensor: 80              # 村民最近床传感器频率
      villagerbabiessensor: 40          # 村民婴儿传感器频率
      playersensor: 40                  # 村民玩家传感器频率
      nearestlivingentitysensor: 40     # 村民最近实体传感器频率

anti-xray:
  enabled: false                        # Anti-Xray 会消耗性能，按需开启
```

**Anti-Xray 性能影响：**

Anti-Xray 功能会在发送区块数据时进行额外处理，对性能有一定影响。如果服务器性能紧张，可以考虑关闭此功能或使用 `engine-mode: 1`（性能消耗较低）。

### purpur.yml

```yaml
settings:
  villager:
    lobotomize:
      enabled: true                     # 启用村民"脑叶切除"
      check-interval: 100               # 检查间隔（tick）
    search-radius:
      acquire-poi: 16                   # 村民搜索工作站范围
      nearest-bed-sensor: 16            # 村民搜索床范围
```

**村民 lobotomize 功能：**

Purpur 的 lobotomize 功能会禁用无法到达工作站的村民的 AI，大幅降低村民造成的性能消耗。这对于拥有大量村民交易所的服务器非常有用。

### 推荐优化配置参数表

以下是针对不同服务器规模的推荐配置：

**小型服务器（1-20 人）：**

| 配置文件 | 参数 | 推荐值 |
|---------|-----|-------|
| server.properties | view-distance | 8 |
| server.properties | simulation-distance | 6 |
| bukkit.yml | spawn-limits.monsters | 50 |
| spigot.yml | entity-activation-range.monsters | 24 |
| paper | max-auto-save-chunks-per-tick | 24 |

**中型服务器（20-50 人）：**

| 配置文件 | 参数 | 推荐值 |
|---------|-----|-------|
| server.properties | view-distance | 6 |
| server.properties | simulation-distance | 4 |
| bukkit.yml | spawn-limits.monsters | 40 |
| spigot.yml | entity-activation-range.monsters | 20 |
| paper | max-auto-save-chunks-per-tick | 16 |

**大型服务器（50+ 人）：**

| 配置文件 | 参数 | 推荐值 |
|---------|-----|-------|
| server.properties | view-distance | 5 |
| server.properties | simulation-distance | 3 |
| bukkit.yml | spawn-limits.monsters | 30 |
| spigot.yml | entity-activation-range.monsters | 16 |
| paper | max-auto-save-chunks-per-tick | 8 |

## 实体优化

实体（生物、掉落物、矿车等）是服务器性能消耗的主要来源之一。

### 减少实体数量

**调整生物生成上限：**

在 `bukkit.yml` 中降低 `spawn-limits` 的值，减少世界中的生物总数。

**使用清理插件：**

安装实体清理插件（如 ClearLagg），定期清理多余的实体：
- 掉落物
- 经验球
- 箭矢
- 无主矿车和船

**限制农场规模：**

大型刷怪塔和农场会产生大量实体。可以通过以下方式限制：
- 设置每区块实体数量上限
- 限制刷怪笼的效率
- 使用插件限制农场规模

### 实体激活范围调整

实体激活范围决定了实体在多远距离内会执行完整的 AI 计算。

**在 spigot.yml 中调整：**

```yaml
entity-activation-range:
  animals: 16       # 动物
  monsters: 24      # 怪物
  raiders: 48       # 袭击者（保持较高以确保袭击正常）
  misc: 8           # 杂项实体
  water: 8          # 水生生物
  villagers: 16     # 村民
  flying-monsters: 32  # 飞行怪物
```

降低这些值可以显著减少 CPU 占用，但可能影响游戏体验（如远处的怪物不会主动攻击）。

### 村民优化

村民是 Minecraft 中 AI 最复杂的生物之一，大量村民会严重影响服务器性能。

**Paper 优化选项：**

在 `paper-world-defaults.yml` 中调整村民相关参数：

```yaml
tick-rates:
  behavior:
    villager:
      validatenearbypoi: 60    # 增加验证间隔
  sensor:
    villager:
      secondarypoisensor: 80
      nearestbedsensor: 80
      villagerbabiessensor: 40
      playersensor: 40
      nearestlivingentitysensor: 40
```

**Purpur lobotomize 功能：**

如果使用 Purpur 服务端，强烈建议启用村民 lobotomize 功能：

```yaml
villager:
  lobotomize:
    enabled: true
    check-interval: 100
```

**其他建议：**

- 将村民交易所建在远离玩家常驻区域的地方
- 使用命名牌命名重要村民，防止被清理
- 考虑使用插件将村民替换为 NPC

### 清理掉落物

掉落物过多会影响服务器性能。

**调整合并半径：**

在 `spigot.yml` 中增加掉落物合并半径：

```yaml
merge-radius:
  item: 4.0    # 默认 2.5
  exp: 6.0     # 默认 3.0
```

**设置掉落物消失时间：**

在 `spigot.yml` 中调整：

```yaml
item-despawn-rate: 6000    # 默认 6000（5 分钟）
```

可以适当降低此值以更快清理掉落物。

## 区块优化

区块加载和处理是服务器性能消耗的另一个主要来源。

### 视距和模拟距离的区别

**视距（view-distance）：**
- 决定服务器发送给客户端的区块范围
- 影响玩家能看到多远的地形
- 主要影响网络带宽和客户端性能

**模拟距离（simulation-distance）：**
- 决定服务器实际处理的区块范围
- 影响实体 AI、红石、作物生长等
- 直接影响服务器 CPU 性能

**优化建议：**

- 将 `simulation-distance` 设置为 4-6
- 将 `view-distance` 设置为 6-10
- 模拟距离应小于或等于视距

### 预生成区块

预生成世界区块可以避免玩家探索时的实时生成开销。

> 详细的预生成方法请参阅 [世界管理](世界管理.md#预生成世界)。

**推荐工具：**

- **Chunky**：最流行的区块预生成插件
- **WorldBorder**：可以配合世界边界进行预生成

**预生成建议：**

- 在服务器开放前预生成主要游玩区域
- 设置世界边界限制探索范围
- 预生成半径建议为 5000-10000 格

### 区块加载优化

**Paper 区块加载优化：**

```yaml
chunks:
  delay-chunk-unloads-by: 10s    # 延迟卸载区块，减少频繁加载/卸载
  max-auto-save-chunks-per-tick: 24    # 限制每 tick 保存的区块数
  prevent-moving-into-unloaded-chunks: true    # 防止进入未加载区块
```

**减少区块加载的方法：**

- 设置合理的世界边界
- 限制玩家的移动速度（如禁用鞘翅加速）
- 使用传送点代替长距离移动

## 插件优化

插件是服务器功能的重要组成部分，但不当的插件使用会严重影响性能。

### 避免使用性能差的插件

**识别性能差的插件：**

- 使用 Spark 分析报告查看各插件的 CPU 占用
- 关注插件的更新频率和维护状态
- 查看插件的用户评价和性能反馈

**选择插件的原则：**

- 优先选择知名开发者的插件
- 选择定期更新和维护的插件
- 避免使用功能过于复杂的全能型插件
- 优先选择原生支持你所使用服务端的插件

### 插件数量控制

插件数量并非越多越好。每个插件都会：
- 占用内存
- 注册事件监听器
- 可能执行定时任务

**建议：**

- 小型服务器：控制在 20 个以内
- 中型服务器：控制在 40 个以内
- 大型服务器：根据实际需求精简

**精简插件的方法：**

- 移除不再使用的插件
- 合并功能重复的插件
- 使用多功能插件替代多个单一功能插件（但要注意性能）

### 常见性能杀手插件

以下类型的插件通常对性能影响较大：

**高性能消耗插件类型：**

| 插件类型 | 性能影响原因 | 优化建议 |
|---------|------------|---------|
| 全息显示（Hologram） | 频繁更新实体数据 | 减少全息数量，增加更新间隔 |
| 动态地图（Dynmap） | 持续渲染地图 | 降低渲染频率，限制渲染范围 |
| 实体堆叠 | 频繁检查和合并实体 | 调整检查间隔 |
| 反作弊 | 持续监控玩家行为 | 选择轻量级方案 |
| 记录/回滚 | 大量数据库操作 | 使用异步处理，定期清理 |

**具体插件建议：**

- **Dynmap**：设置较长的渲染间隔，限制渲染区域
- **CoreProtect**：定期清理旧数据，使用 MySQL 而非 SQLite
- **Citizens**：控制 NPC 数量，禁用不必要的 AI 特性
- **WorldEdit**：限制单次操作的方块数量

## 红石和漏斗优化

红石电路和漏斗是 Minecraft 中常见的性能消耗来源。

### 红石优化

**Paper 红石优化选项：**

Paper 提供了替代的红石算法，可以在保持大部分兼容性的同时提升性能：

```yaml
# paper-world-defaults.yml
redstone-implementation: ALTERNATE_CURRENT
```

可选值：
- `VANILLA`：原版红石算法
- `EIGENCRAFT`：优化版本，兼容性较好
- `ALTERNATE_CURRENT`：最优化版本，可能影响部分红石机器

**红石优化建议：**

- 避免建造过于复杂的红石机器
- 使用红石中继器断开长距离红石线
- 考虑使用命令方块替代复杂红石逻辑
- 限制红石时钟的速度

### 漏斗优化

漏斗是服务器性能的主要消耗者之一，因为它们需要频繁检查物品。

**Spigot 漏斗优化：**

```yaml
# spigot.yml
hopper-transfer: 8    # 漏斗传输间隔（tick）
hopper-check: 1       # 漏斗检查间隔（tick）
hopper-amount: 1      # 每次传输的物品数量
```

增加 `hopper-transfer` 的值可以降低漏斗的检查频率，但会降低传输速度。

**Paper 漏斗优化：**

```yaml
# paper-world-defaults.yml
hopper:
  cooldown-when-full: true    # 漏斗满时启用冷却
  disable-move-event: false   # 禁用移动事件（可能影响保护插件）
  ignore-occluding-blocks: false
```

**漏斗优化建议：**

- 使用水流代替漏斗传输物品
- 减少漏斗链的长度
- 使用漏斗矿车代替大量漏斗
- 在漏斗上方放置堆肥桶减少检查开销

## 模组服优化

如果运行 Forge 或 Fabric 模组服务器，可以使用专门的优化模组。

### Fabric 优化模组

**Lithium**

Lithium 是最推荐的 Fabric 服务端优化模组，它优化了游戏的多个系统而不改变原版行为。

- 优化实体 AI 和碰撞检测
- 优化区块加载和保存
- 优化红石和方块更新
- 完全兼容原版行为

**Starlight**

Starlight 重写了 Minecraft 的光照引擎，大幅提升光照计算性能。

- 光照计算速度提升数倍
- 减少区块加载时的卡顿
- 已被 Paper 1.19+ 内置

**FerriteCore**

FerriteCore 优化内存使用，减少服务器的内存占用。

- 优化方块状态存储
- 减少模型数据内存占用
- 对大型模组包效果显著

**推荐组合：**

```
Lithium + Starlight + FerriteCore
```

这三个模组可以同时使用，互不冲突。

### Forge 优化模组

**Canary**

Canary 是 Lithium 的 Forge 移植版本，提供类似的优化效果。

**Starlight（Forge 版）**

Starlight 也有 Forge 版本，提供相同的光照优化。

**其他推荐：**

- **Clumps**：合并经验球，减少实体数量
- **FastFurnace**：优化熔炉性能
- **FastWorkbench**：优化工作台配方查找

### 模组服通用建议

- 定期更新模组到最新版本
- 移除不使用的模组
- 使用性能分析工具（如 Spark）找出问题模组
- 调整模组配置中的性能相关选项
- 考虑使用模组包优化整合包（如 Better Minecraft 等已优化的整合包）

## 总结

服务器性能优化是一个持续的过程，需要根据实际情况不断调整。以下是优化的优先级建议：

1. **诊断问题**：使用 Spark 找出性能瓶颈
2. **硬件升级**：确保硬件满足基本要求
3. **JVM 优化**：使用 Aikar's Flags
4. **配置优化**：调整服务端配置参数
5. **实体优化**：减少实体数量和激活范围
6. **插件优化**：精简和优化插件
7. **持续监控**：定期检查服务器性能状态

记住，优化的目标是在保持良好游戏体验的前提下提升性能，过度优化可能会影响玩家的游戏体验。建议在每次调整后观察效果，找到适合自己服务器的平衡点。

