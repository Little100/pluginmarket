# 反作弊插件指南

## 概述

### 什么是作弊/外挂

作弊客户端（Hack Client）是经过修改的 Minecraft 客户端，内置了各种作弊功能，允许玩家获得不公平的游戏优势。这些客户端通过修改游戏数据包、绕过客户端限制或利用游戏漏洞来实现作弊效果。

常见的作弊客户端包括：Wurst、Impact、Aristois、Future 等。

### 常见的作弊类型

| 作弊类型 | 英文名称 | 描述 |
|---------|---------|------|
| 飞行 | Fly | 允许玩家在生存模式下飞行 |
| 加速 | Speed | 提高玩家移动速度 |
| 杀戮光环 | KillAura | 自动攻击范围内的实体 |
| 矿物透视 | X-Ray | 透过方块看到矿物位置 |
| 自动点击 | AutoClicker | 自动高频点击鼠标 |
| 穿墙 | NoClip | 穿过固体方块 |
| 反击退 | AntiKnockback | 减少或消除受到的击退效果 |
| 自动瞄准 | Aimbot | 自动瞄准其他玩家 |
| 高跳 | HighJump | 跳跃高度超过正常值 |
| 无摔落伤害 | NoFall | 免疫摔落伤害 |
| 自动搭路 | Scaffold | 自动在脚下放置方块 |
| 快速挖掘 | FastBreak | 加快方块破坏速度 |
| 自动钓鱼 | AutoFish | 自动完成钓鱼操作 |
| 物品透视 | ChestESP | 高亮显示箱子等容器 |
| 玩家透视 | PlayerESP | 透过方块看到其他玩家 |

### 为什么需要反作弊插件

1. **维护游戏公平性**：作弊行为破坏了游戏的公平竞争环境，影响正常玩家的游戏体验
2. **保护服务器经济**：矿物透视等作弊会破坏服务器的经济平衡
3. **防止 PvP 不公平**：杀戮光环、自动瞄准等作弊在 PvP 中造成极大不公平
4. **维护服务器秩序**：飞行、穿墙等作弊可能被用于恶意破坏
5. **保护玩家数据**：某些作弊可能被用于盗取其他玩家的物品

---

## 主流反作弊插件对比

### NoCheatPlus (NCP)

- **价格**：免费
- **类型**：开源
- **地址**：https://github.com/Updated-NoCheatPlus/NoCheatPlus
- **特点**：
  - 老牌反作弊插件，社区维护
  - 检测覆盖面广
  - 配置灵活但复杂
  - 对服务器性能影响较小
  - 更新频率较低

### Vulcan

- **价格**：付费（约 20 美元）
- **类型**：闭源
- **地址**：https://www.spigotmc.org/resources/vulcan-anti-cheat-advanced-cheat-detection.83626/
- **特点**：
  - 检测精度高
  - 误判率低
  - 持续更新维护
  - 专业技术支持
  - 性能优化良好

### Grim (GrimAC)

- **价格**：免费
- **类型**：开源
- **地址**：https://github.com/GrimAnticheat/Grim
- **特点**：
  - 基于数据包分析
  - 预测性检测机制
  - 对移动类作弊检测效果好
  - 活跃的社区维护
  - 支持 1.8-1.20+ 版本

### Matrix

- **价格**：免费版 + 付费版
- **类型**：闭源
- **地址**：https://matrix.rip/
- **特点**：
  - 免费版功能完整
  - 付费版提供更多检测
  - 配置相对简单
  - 中文社区支持较好

### Spartan

- **价格**：付费（约 23 美元）
- **类型**：闭源
- **地址**：https://www.spigotmc.org/resources/spartan-advanced-anti-cheat-cheat-detection-hack-blocker.25638/
- **特点**：
  - 功能全面
  - 内置违规管理系统
  - 支持云端检测
  - 详细的检测日志
  - 持续更新

### Themis

- **价格**：免费
- **类型**：开源
- **地址**：https://github.com/Jenya705/Themis
- **特点**：
  - 轻量级设计
  - 对服务器性能影响小
  - 适合小型服务器
  - 基础检测功能

### 反作弊插件对比表格

| 插件 | 价格 | 检测能力 | 性能开销 | 维护状态 | 适用场景 |
|------|------|---------|---------|---------|---------|
| NoCheatPlus | 免费 | ★★★☆☆ | 低 | 社区维护 | 小型服务器、预算有限 |
| Vulcan | 付费 | ★★★★★ | 中 | 活跃 | 大型服务器、PvP 服务器 |
| Grim | 免费 | ★★★★☆ | 中 | 活跃 | 中大型服务器、技术型服主 |
| Matrix | 免费/付费 | ★★★★☆ | 中 | 活跃 | 中型服务器、中文用户 |
| Spartan | 付费 | ★★★★☆ | 中高 | 活跃 | 功能需求全面的服务器 |
| Themis | 免费 | ★★☆☆☆ | 低 | 一般 | 小型服务器、轻量需求 |

---

## 反作弊配置指南

### 安装与基础配置

1. **下载插件**：从官方渠道下载对应版本的反作弊插件
2. **放置插件**：将 `.jar` 文件放入服务器的 `plugins` 文件夹
3. **重启服务器**：重启服务器以加载插件
4. **生成配置**：插件会自动生成默认配置文件

以 Grim 为例，基础配置文件结构：

```yaml
# config.yml
# 检测灵敏度设置
Simulation:
  # 预测误差容忍度
  threshold: 0.001
  # 最大预测偏差
  max-prediction-error: 0.03

# 惩罚设置
Punishments:
  # 违规次数阈值
  violation-threshold: 20
  # 惩罚命令
  commands:
    - "kick %player% 检测到异常行为"
```

### 误判处理

误判是反作弊插件的常见问题，以下是处理方法：

#### 调整灵敏度

```yaml
# 降低检测灵敏度以减少误判
checks:
  flight:
    # 将灵敏度从 high 调整为 medium
    sensitivity: medium
  speed:
    # 增加容忍度
    tolerance: 0.1
```

#### 设置白名单

```yaml
# 白名单配置
exemptions:
  # 按权限豁免
  permissions:
    - "anticheat.bypass"
    - "anticheat.exempt"
  # 按玩家名豁免（不推荐）
  players:
    - "AdminPlayer"
```

#### 针对特定情况豁免

```yaml
# 特定情况豁免
bypass:
  # 骑乘时豁免移动检测
  riding: true
  # 使用鞘翅时豁免飞行检测
  elytra: true
  # 在水中时豁免速度检测
  swimming: true
```

### 惩罚机制配置

反作弊插件通常支持多级惩罚机制：

```yaml
# 惩罚配置示例
punishments:
  # 第一级：警告
  level1:
    violations: 10
    actions:
      - "warn %player% 检测到可疑行为，请停止作弊"
  
  # 第二级：踢出
  level2:
    violations: 30
    actions:
      - "kick %player% 多次违规，已被踢出服务器"
  
  # 第三级：临时封禁
  level3:
    violations: 50
    actions:
      - "tempban %player% 1h 作弊行为"
  
  # 第四级：永久封禁
  level4:
    violations: 100
    actions:
      - "ban %player% 严重作弊行为"

# 违规衰减设置
violation-decay:
  # 每分钟衰减的违规点数
  rate: 1
  # 衰减间隔（秒）
  interval: 60
```

### 与其他插件的兼容性

某些插件可能与反作弊产生冲突，导致误判：

| 插件类型 | 可能触发的误判 | 解决方案 |
|---------|--------------|---------|
| mcMMO | 技能加速触发速度检测 | 添加 mcMMO 技能豁免 |
| Jobs | 工作技能触发异常检测 | 配置 Jobs 相关豁免 |
| EssentialsX | /fly 命令触发飞行检测 | 同步权限检测 |
| Vehicles | 载具移动触发速度检测 | 添加载具豁免 |
| 自定义物品插件 | 特殊物品效果触发检测 | 针对性配置豁免 |

兼容性配置示例：

```yaml
# 插件兼容性配置
compatibility:
  mcmmo:
    enabled: true
    # 豁免 mcMMO 技能期间的检测
    exempt-during-ability: true
  
  jobs:
    enabled: true
    # 豁免工作技能
    exempt-job-abilities: true
  
  essentials:
    enabled: true
    # 同步飞行权限
    sync-fly-permission: true
```

---

## 反矿物透视

矿物透视（X-Ray）是最常见的作弊类型之一，需要专门的防护措施。

### Paper 内置的反矿透

Paper 服务端内置了矿物混淆功能，无需额外插件。

配置文件位置：`config/paper-world-defaults.yml`

```yaml
anticheat:
  anti-xray:
    enabled: true
    engine-mode: 1
    hidden-blocks:
      - copper_ore
      - deepslate_copper_ore
      - gold_ore
      - deepslate_gold_ore
      - iron_ore
      - deepslate_iron_ore
      - coal_ore
      - deepslate_coal_ore
      - lapis_ore
      - deepslate_lapis_ore
      - mossy_cobblestone
      - obsidian
      - chest
      - diamond_ore
      - deepslate_diamond_ore
      - redstone_ore
      - deepslate_redstone_ore
      - clay
      - emerald_ore
      - deepslate_emerald_ore
      - ender_chest
    lava-obscures: false
    max-block-height: 64
    replacement-blocks:
      - stone
      - oak_planks
      - deepslate
    update-radius: 2
    use-permission: false
```

### engine-mode 1 vs engine-mode 2

| 特性 | engine-mode 1 | engine-mode 2 |
|-----|--------------|--------------|
| 工作原理 | 隐藏未暴露的矿物 | 用假矿物替换石头 |
| 客户端表现 | 矿物不可见 | 到处都是假矿物 |
| 性能开销 | 较低 | 较高 |
| 防护效果 | 一般 | 优秀 |
| 带宽消耗 | 较低 | 较高 |
| 推荐场景 | 性能敏感的服务器 | 安全要求高的服务器 |

engine-mode 2 配置示例：

```yaml
anticheat:
  anti-xray:
    enabled: true
    engine-mode: 2
    hidden-blocks:
      - air
      - copper_ore
      - deepslate_copper_ore
      - diamond_ore
      - deepslate_diamond_ore
      - gold_ore
      - deepslate_gold_ore
      - iron_ore
      - deepslate_iron_ore
      - lapis_ore
      - deepslate_lapis_ore
      - redstone_ore
      - deepslate_redstone_ore
      - emerald_ore
      - deepslate_emerald_ore
      - coal_ore
      - deepslate_coal_ore
    max-block-height: 64
    replacement-blocks:
      - chest
      - diamond_ore
      - deepslate_diamond_ore
      - emerald_ore
      - deepslate_emerald_ore
      - gold_ore
      - deepslate_gold_ore
      - iron_ore
      - deepslate_iron_ore
      - lapis_ore
      - deepslate_lapis_ore
      - redstone_ore
      - deepslate_redstone_ore
    update-radius: 2
```

### Orebfuscator 插件

对于非 Paper 服务端，可以使用 Orebfuscator 插件实现类似功能。

- **地址**：https://github.com/Imprex-Development/Orebfuscator
- **支持**：Spigot、Paper、Folia

基础配置：

```yaml
# config.yml
general:
  # 检查更新
  checkForUpdates: true
  # 更新半径
  updateRadius: 2
  # 初始半径
  initialRadius: 1

cache:
  # 启用缓存
  enabled: true
  # 缓存目录
  directory: "orebfuscator_cache"
  # 最大缓存大小（MB）
  maxSize: 1024

# 世界配置
worlds:
  world:
    enabled: true
    engine-mode: 2
    hidden-blocks:
      - diamond_ore
      - deepslate_diamond_ore
      - emerald_ore
      - deepslate_emerald_ore
      - gold_ore
      - deepslate_gold_ore
    replacement-blocks:
      - stone
      - deepslate
```

---

## 反 X-Ray 纹理包

### 服务端反 X-Ray 的原理

服务端反 X-Ray 通过以下方式工作：

1. **数据包拦截**：在发送区块数据给客户端之前进行处理
2. **方块替换**：将隐藏的方块数据替换为其他方块
3. **动态更新**：当玩家靠近或破坏方块时，发送真实数据
4. **视线检测**：只有当方块暴露在空气中时才显示真实方块

这种方式的优势：
- 不依赖客户端
- 对所有 X-Ray 方式有效（材质包、模组、外挂）
- 无法被客户端绕过

### 配置建议

针对不同服务器类型的配置建议：

#### 生存服务器

```yaml
anticheat:
  anti-xray:
    enabled: true
    engine-mode: 2
    max-block-height: 64
    # 隐藏所有贵重矿物
    hidden-blocks:
      - diamond_ore
      - deepslate_diamond_ore
      - emerald_ore
      - deepslate_emerald_ore
      - ancient_debris
      - gold_ore
      - deepslate_gold_ore
```

#### 空岛服务器

```yaml
anticheat:
  anti-xray:
    enabled: true
    engine-mode: 1
    # 空岛服主要防止透视箱子
    hidden-blocks:
      - chest
      - trapped_chest
      - ender_chest
      - barrel
      - shulker_box
```

#### 地皮服务器

```yaml
anticheat:
  anti-xray:
    enabled: true
    engine-mode: 1
    # 地皮服主要防止透视容器和刷怪笼
    hidden-blocks:
      - chest
      - spawner
      - ender_chest
```

---

## 辅助措施

除了反作弊插件，还可以通过其他措施加强服务器安全。

### 服务端移动速度限制

在 `spigot.yml` 中配置：

```yaml
settings:
  # 移动速度限制
  moved-wrongly-threshold: 0.0625
  moved-too-quickly-multiplier: 10.0
```

在 `server.properties` 中：

```properties
# 玩家移动检测
max-tick-time=60000
```

### 飞行检测

在 `server.properties` 中配置：

```properties
# 禁止飞行（生存模式）
allow-flight=false
```

注意：如果服务器有飞行相关功能（如 VIP 飞行权限），需要配合权限插件使用，而不是直接禁用。

### 举报系统插件

推荐的举报系统插件：

#### ReportSystem

- **地址**：https://www.spigotmc.org/resources/reportsystem.78728/
- **功能**：
  - 玩家举报系统
  - 管理员审核界面
  - 举报历史记录
  - Discord 通知集成

配置示例：

```yaml
# config.yml
settings:
  # 举报冷却时间（秒）
  cooldown: 300
  # 最小举报理由长度
  min-reason-length: 10
  
notifications:
  # 通知在线管理员
  notify-staff: true
  # Discord Webhook
  discord-webhook: "https://discord.com/api/webhooks/..."
```

#### BanManager

- **地址**：https://www.spigotmc.org/resources/banmanager.8531/
- **功能**：
  - 完整的封禁管理
  - Web 界面
  - 举报功能
  - 多服务器同步

### 录像回放

录像回放插件可以记录玩家行为，用于事后审核。

#### AdvancedReplay

- **地址**：https://www.spigotmc.org/resources/advancedreplay-record-your-players.52849/
- **功能**：
  - 录制玩家行为
  - 回放查看
  - 支持多玩家录制
  - 存储管理

配置示例：

```yaml
# config.yml
recording:
  # 自动录制
  auto-record: false
  # 录制时长限制（分钟）
  max-duration: 30
  # 存储路径
  save-path: "replays/"
  
# 录制触发条件
triggers:
  # 被举报时自动录制
  on-report: true
  # 违规时自动录制
  on-violation: true
```

#### ReplayMod 服务端 API

- **地址**：https://github.com/ReplayMod/ReplayMod
- **说明**：需要配合客户端 ReplayMod 使用

---

## 最佳实践

### 不要只依赖一个反作弊插件

单一反作弊插件无法覆盖所有作弊类型。推荐组合使用：

| 组合方案 | 适用场景 | 说明 |
|---------|---------|------|
| Grim + Paper Anti-Xray | 中小型服务器 | 免费方案，覆盖面广 |
| Vulcan + Orebfuscator | 大型 PvP 服务器 | 付费方案，检测精度高 |
| NCP + Matrix | 预算有限 | 免费组合，基础防护 |

组合使用时的注意事项：
- 避免功能重叠导致冲突
- 统一惩罚机制
- 合理分配检测任务

### 定期更新反作弊插件

作弊客户端不断更新，反作弊插件也需要保持更新：

1. **订阅更新通知**：关注插件的 GitHub Release 或 SpigotMC 更新
2. **定期检查版本**：每月至少检查一次是否有新版本
3. **测试后更新**：在测试服务器验证后再更新正式服务器
4. **备份配置**：更新前备份配置文件

### 结合人工审核

自动检测无法完全替代人工审核：

1. **设置管理员值班**：确保有管理员在线处理举报
2. **审核可疑玩家**：对多次触发检测的玩家进行人工观察
3. **使用旁观模式**：管理员可以使用旁观模式观察可疑玩家
4. **录像回放**：对于复杂情况，使用录像回放进行分析

管理员审核命令示例：

```
/gamemode spectator          # 进入旁观模式
/tp <玩家名>                  # 传送到可疑玩家
/vanish                      # 隐身（需要 Essentials 或类似插件）
```

### 社区举报机制

建立完善的社区举报机制：

1. **举报渠道**
   - 游戏内举报命令：`/report <玩家> <原因>`
   - Discord 举报频道
   - 论坛举报板块

2. **举报处理流程**
   - 收到举报后 24 小时内响应
   - 调查取证（查看日志、录像）
   - 做出处理决定
   - 反馈给举报者

3. **奖惩机制**
   - 对有效举报给予奖励
   - 对恶意举报进行处罚

4. **透明度**
   - 公开封禁名单
   - 定期发布反作弊报告

### 综合防护建议

```
┌─────────────────────────────────────────────────────────┐
│                    反作弊防护体系                        │
├─────────────────────────────────────────────────────────┤
│  第一层：服务端配置                                      │
│  - server.properties 基础限制                           │
│  - spigot.yml 移动检测                                  │
│  - Paper anti-xray                                      │
├─────────────────────────────────────────────────────────┤
│  第二层：反作弊插件                                      │
│  - 主反作弊（Grim/Vulcan/NCP）                          │
│  - 辅助检测（Matrix/Themis）                            │
├─────────────────────────────────────────────────────────┤
│  第三层：辅助系统                                        │
│  - 举报系统                                             │
│  - 录像回放                                             │
│  - 日志记录                                             │
├─────────────────────────────────────────────────────────┤
│  第四层：人工审核                                        │
│  - 管理员巡查                                           │
│  - 举报处理                                             │
│  - 社区监督                                             │
└─────────────────────────────────────────────────────────┘
```

---

## 总结

反作弊是服务器运营的重要组成部分。有效的反作弊策略需要：

1. 选择适合服务器规模和类型的反作弊插件
2. 正确配置插件参数，平衡检测精度和误判率
3. 使用多层防护，不依赖单一解决方案
4. 保持插件更新，跟进最新的作弊手段
5. 结合人工审核和社区举报机制

没有完美的反作弊方案，但通过合理的配置和持续的维护，可以有效减少作弊行为对服务器的影响。
