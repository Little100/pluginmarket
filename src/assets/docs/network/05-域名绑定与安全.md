# 域名绑定与安全

本文介绍如何为 Minecraft 服务器绑定域名，以及服务器安全相关的注意事项。

---

## 域名绑定

使用域名代替 IP 地址有以下好处：

- 更容易记忆
- IP 变化时只需更新 DNS，玩家无需修改
- 可以使用 SRV 记录隐藏端口号
- 更专业的形象

### DNS 记录类型

| 记录类型 | 用途 | 示例 |
|----------|------|------|
| A | 将域名指向 IPv4 地址 | `mc.example.com` → `1.2.3.4` |
| AAAA | 将域名指向 IPv6 地址 | `mc.example.com` → `2001:db8::1` |
| SRV | 指定服务的地址和端口 | 可以隐藏端口号 |
| CNAME | 将域名指向另一个域名 | `mc.example.com` → `server.example.com` |

### 配置 A 记录

A 记录将域名指向 IPv4 地址。

**配置步骤**：

1. 登录域名管理控制台（如阿里云、腾讯云、Cloudflare）
2. 进入 DNS 解析设置
3. 添加记录：
   - 记录类型：A
   - 主机记录：`mc`（或其他子域名）
   - 记录值：服务器的 IPv4 地址
   - TTL：600（或默认值）

**配置示例**：

| 主机记录 | 记录类型 | 记录值 |
|----------|----------|--------|
| mc | A | 123.45.67.89 |

配置完成后，玩家可以使用 `mc.example.com:25565` 连接。

### 配置 AAAA 记录

AAAA 记录将域名指向 IPv6 地址。

**配置步骤**：

1. 添加记录：
   - 记录类型：AAAA
   - 主机记录：`mc`
   - 记录值：服务器的 IPv6 地址

**配置示例**：

| 主机记录 | 记录类型 | 记录值 |
|----------|----------|--------|
| mc | AAAA | 240e:xxxx:xxxx:xxxx:xxxx:xxxx:xxxx:xxxx |

如果同时配置了 A 和 AAAA 记录，客户端会自动选择可用的协议。

### 配置 SRV 记录

SRV 记录可以指定服务的端口，让玩家无需输入端口号即可连接。

**SRV 记录格式**：

```
_minecraft._tcp.mc.example.com. 86400 IN SRV 0 5 25565 mc.example.com.
```

**配置步骤**：

1. 添加记录：
   - 记录类型：SRV
   - 主机记录：`_minecraft._tcp.mc`（或 `_minecraft._tcp`）
   - 记录值：`0 5 25565 mc.example.com.`

**记录值说明**：

```
优先级 权重 端口 目标主机
0      5    25565 mc.example.com.
```

| 字段 | 说明 |
|------|------|
| 优先级 | 数字越小优先级越高，通常填 0 |
| 权重 | 相同优先级时的权重，通常填 5 |
| 端口 | 服务器端口 |
| 目标主机 | 服务器域名（需要以 `.` 结尾） |

**配置示例**：

| 主机记录 | 记录类型 | 记录值 |
|----------|----------|--------|
| _minecraft._tcp.mc | SRV | 0 5 25565 mc.example.com. |

配置完成后，玩家可以直接使用 `mc.example.com` 连接，无需输入端口号。

### 不同 DNS 服务商的 SRV 配置

**阿里云**：

1. 进入云解析 DNS
2. 添加记录
3. 记录类型选择 SRV
4. 主机记录填写 `_minecraft._tcp.mc`
5. 记录值填写 `0 5 25565 mc.example.com.`

**腾讯云**：

1. 进入 DNSPod
2. 添加记录
3. 记录类型选择 SRV
4. 主机记录填写 `_minecraft._tcp.mc`
5. 记录值填写 `0 5 25565 mc.example.com.`

**Cloudflare**：

1. 进入 DNS 设置
2. 添加记录
3. 类型选择 SRV
4. 名称填写 `_minecraft._tcp.mc`
5. 分别填写优先级、权重、端口、目标

### 基岩版 SRV 记录

基岩版也支持 SRV 记录，但格式略有不同：

| 主机记录 | 记录类型 | 记录值 |
|----------|----------|--------|
| _minecraft._udp.mc | SRV | 0 5 19132 mc.example.com. |

**注意**：基岩版使用 `_udp` 而不是 `_tcp`。

---

## 安全注意事项

公网开服意味着服务器暴露在互联网上，需要注意安全问题。

### 端口安全

**原则：只开放必要的端口**

| 端口 | 是否需要开放 |
|------|--------------|
| 25565 (TCP) | 是，Java 版必需 |
| 19132 (UDP) | 仅在支持基岩版时开放 |
| 22 (SSH) | 建议限制来源 IP |
| 3306 (MySQL) | 不建议开放，使用本地连接 |
| 其他端口 | 除非必要，否则不开放 |

**SSH 端口安全建议**：

1. 修改默认端口（从 22 改为其他端口）
2. 禁用密码登录，使用密钥认证
3. 限制允许连接的 IP 地址

### 防火墙配置

确保防火墙只允许必要的流量。

**Windows**：

```powershell
# 查看所有入站规则
Get-NetFirewallRule -Direction Inbound | Where-Object {$_.Enabled -eq 'True'}
```

**Linux (firewalld)**：

```bash
# 查看已开放的端口
sudo firewall-cmd --list-ports

# 移除不需要的端口
sudo firewall-cmd --permanent --remove-port=端口号/协议
sudo firewall-cmd --reload
```

**Linux (ufw)**：

```bash
# 查看防火墙状态
sudo ufw status verbose

# 删除规则
sudo ufw delete allow 端口号/协议
```

### DDoS 防护基础

DDoS（分布式拒绝服务）攻击是游戏服务器常见的威胁。

**基础防护措施**：

1. **不要公开服务器 IP**
   - 使用域名而不是直接告诉玩家 IP
   - 在 Cloudflare 等 CDN 后面隐藏真实 IP（仅对网站有效）

2. **使用云服务商的 DDoS 防护**
   - 阿里云、腾讯云等都提供基础 DDoS 防护
   - 可以购买高防 IP 获得更强防护

3. **配置连接限制**
   - 限制单 IP 的连接数
   - 使用插件限制登录频率

4. **监控异常流量**
   - 关注服务器带宽使用情况
   - 设置告警通知

**服务端防护插件**：

| 插件 | 功能 |
|------|------|
| AntiBot | 防止机器人攻击 |
| IPWhitelist | IP 白名单 |
| BotSentry | 检测和阻止机器人 |

### 服务器软件安全

1. **及时更新**
   - 保持服务端软件最新版本
   - 及时更新插件

2. **只安装可信的插件**
   - 从官方渠道下载插件
   - 不要使用来路不明的插件

3. **定期备份**
   - 定期备份世界数据和配置
   - 将备份存储在不同位置

4. **权限管理**
   - 不要给玩家过高的权限
   - 使用权限插件精细控制

### 个人信息保护

1. **不要在服务器名称或 MOTD 中暴露个人信息**
2. **使用独立的邮箱注册域名和云服务**
3. **开启域名隐私保护（WHOIS Privacy）**

---

## 验证域名配置

### 检查 DNS 解析

**Windows**：

```cmd
nslookup mc.example.com
nslookup -type=SRV _minecraft._tcp.mc.example.com
```

**Linux**：

```bash
dig mc.example.com
dig SRV _minecraft._tcp.mc.example.com
```

### 在线工具

- https://mcsrvstat.us - 检查 Minecraft 服务器状态
- https://dnschecker.org - 检查 DNS 解析是否生效

---

## 常见问题

### DNS 解析不生效

1. 等待 DNS 传播（通常需要几分钟到几小时）
2. 清除本地 DNS 缓存：
   - Windows: `ipconfig /flushdns`
   - Linux: `sudo systemd-resolve --flush-caches`
3. 检查记录配置是否正确

### SRV 记录不工作

1. 确认记录格式正确
2. 确认目标主机末尾有 `.`
3. 部分老版本客户端不支持 SRV 记录

### 域名无法访问但 IP 可以

1. 检查 DNS 解析是否正确
2. 检查是否有 CDN 或代理影响
3. 尝试使用其他 DNS 服务器测试

---

## 总结

公网开服是 Minecraft 服务器对外开放的最佳方式，但需要注意：

1. 根据网络条件选择合适的方案（IPv4/IPv6/云服务器）
2. 正确配置端口转发和防火墙
3. 使用域名和 SRV 记录提升用户体验
4. 重视服务器安全，做好防护措施
